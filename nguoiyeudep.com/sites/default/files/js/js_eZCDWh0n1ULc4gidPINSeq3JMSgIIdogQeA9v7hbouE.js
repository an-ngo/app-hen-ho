Drupal.locale = { 'strings': {"":{"An AJAX HTTP error occurred.":"C\u00f3 l\u1ed7i AJAX HTTP.","HTTP Result Code: !status":"K\u1ebft qu\u1ea3 m\u00e3 HTTP: !status","An AJAX HTTP request terminated abnormally.":"Y\u00eau c\u1ea7u AJAX HTTP k\u1ebft th\u00fac b\u1ea5t th\u01b0\u1eddng.","Debugging information follows.":"R\u00e0 l\u1ed7i theo th\u00f4ng tin sau.","Path: !uri":"\u0110\u01b0\u1eddng d\u1eabn: !uri","StatusText: !statusText":"StatusText: !statusText","ResponseText: !responseText":"ResponseTextt: !responseText","ReadyState: !readyState":"ReadyState: !readyState","All":"T\u1ea5t c\u1ea3","New":"M\u1edbi","Hide":"\u1ea8n","Show":"Hi\u1ec7n","Please wait...":"Vui l\u00f2ng \u0111\u1ee3i...","Re-order rows by numerical weight instead of dragging.":"S\u1eafp x\u1ebfp l\u1ea1i danh m\u1ee5c theo \u0111\u1ed9 n\u1eb7ng thay v\u00ec k\u00e9o ch\u00fang.","Show row weights":"Hi\u1ec7n tr\u1ecdng s\u1ed1 h\u00e0ng","Hide row weights":"\u1ea8n tr\u1ecdng s\u1ed1 h\u00e0ng","Drag to re-order":"K\u00e9o \u0111\u1ec3 s\u1eafp x\u1ebfp l\u1ea1i","Changes made in this table will not be saved until the form is submitted.":"C\u00e1c thay \u0111\u1ed5i \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n trong b\u1ea3ng n\u00e0y s\u1ebd kh\u00f4ng \u0111\u01b0\u1ee3c l\u01b0u cho \u0111\u1ebfn khi bi\u1ec3u m\u1eabu \u0111\u01b0\u1ee3c \u0111\u1ec7 tr\u00ecnh.","Add":"Th\u00eam","Remove group":"X\u00f3a nh\u00f3m","Revert to default":"\u0110\u1eb7t l\u1ea1i v\u1ec1 m\u1eb7c \u0111\u1ecbnh","Configure":"C\u1ea5u h\u00ecnh","Edit":"S\u1eeda","(active tab)":"(tab ho\u1ea1t \u0111\u1ed9ng)","Requires a title":"Ph\u1ea7n ti\u00eau \u0111\u1ec1 l\u00e0 b\u1eaft bu\u1ed9c","Not published":"Ch\u01b0a c\u00f4ng b\u1ed1","Don\u0027t display post information":"Hi\u1ec3n th\u1ecb tho\u1ea1i th\u00f4ng tin ch\u1eef","This permission is inherited from the authenticated user role.":"Quy\u1ec1n n\u00e0y \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng \u0111\u00e3 x\u00e1c th\u1ef1c.","Autocomplete popup":"B\u1eadt l\u00ean t\u1ef1 ho\u00e0n t\u1ea5t","Searching for matches...":"T\u00ecm kh\u1edbp...","Select all rows in this table":"Ch\u1ecdn t\u1ea5t c\u1ea3 c\u00e1c d\u00f2ng trong b\u1ea3ng n\u00e0y","Deselect all rows in this table":"B\u1ecf ch\u1ecdn t\u1ea5t c\u1ea3 c\u00e1c d\u00f2ng trong b\u1ea3ng n\u00e0y","Status":"Tr\u1ea1ng th\u00e1i","None":"Kh\u00f4ng c\u00f3","Cancel":"H\u1ee7y b\u1ecf","Read more":"Xem th\u00eam","Disabled":"T\u1eaft","Enabled":"B\u1eadt","Size":"Dung l\u01b0\u1ee3ng","Loading":"\u0110ang n\u1ea1p","No title":"Kh\u00f4ng ti\u00eau \u0111\u1ec1","Other":"Kh\u00e1c","Submit":"G\u1eedi \u0111i","Next":"Ti\u1ebfp","none":"kh\u00f4ng c\u00f3","Sunday":"Ch\u1ee7 nh\u1eadt","Monday":"Th\u1ee9 hai","Tuesday":"Th\u1ee9 ba","Wednesday":"Th\u1ee9 t\u01b0","Thursday":"Th\u1ee9 n\u0103m","Friday":"Th\u1ee9 s\u00e1u","Saturday":"Th\u1ee9 b\u1ea3y","Filename":"T\u00ean t\u1eadp tin","Upload":"T\u1ea3i l\u00ean","Done":"Xong","N\/A":"N\/A","OK":"\u0110\u1ed3ng \u00fd","This field is required.":"Tr\u01b0\u1eddng d\u1eef li\u1ec7u n\u00e0y l\u00e0 b\u1eaft bu\u1ed9c.","Prev":"Tr\u01b0\u1edbc","Mon":"T2","Tue":"T3","Wed":"T4","Thu":"T5","Fri":"T6","Sat":"T7","Sun":"CN","January":"Th\u00e1ng 1","February":"Th\u00e1ng 2","March":"Th\u00e1ng 3","April":"Th\u00e1ng 4","May":"Th5","June":"Th\u00e1ng 6","July":"Th\u00e1ng 7","August":"Th\u00e1ng 8","September":"Th\u00e1ng 9","October":"Th\u00e1ng 10","November":"Th\u00e1ng 11","December":"Th\u00e1ng 12","Anonymous users":"Ng\u01b0\u1eddi d\u00f9ng n\u1eb7c danh","Today":"H\u00f4m nay","Jan":"Th1","Mar":"Th3","Apr":"Th4","Jun":"Th6","Jul":"Th7","Aug":"Th8","Sep":"Th9","Oct":"Th10","Nov":"Th11","Dec":"Th12","Su":"CN","Mo":"T2","Tu":"T3","We":"T4","Th":"T5","Fr":"T6","Sa":"T7","mm\/dd\/yy":"mm\/dd\/yy","Only files with the following extensions are allowed: %files-allowed.":"Ch\u1ec9 nh\u1eefng t\u1eadp tin c\u00f3 ph\u1ea7n m\u1edf r\u1ed9ng sau m\u1edbi \u0111\u01b0\u1ee3c ph\u00e9p: %files-allowed.","Not in book":"Kh\u00f4ng n\u1eb1m trong s\u00e1ch","New book":"S\u00e1ch m\u1edbi","By @name on @date":"B\u1edfi @name v\u00e0o l\u00fac @date","By @name":"@name vi\u1ebft","Not in menu":"Kh\u00f4ng c\u00f3 trong tr\u00ecnh \u0111\u01a1n","Alias: @alias":"\u0110\u01b0\u1eddng d\u1eabn \u1ea3o: @alias","No alias":"Ch\u01b0a c\u00f3 \u0111\u01b0\u1eddng d\u1eabn \u1ea3o","New revision":"Phi\u00ean b\u1ea3n m\u1edbi","The changes to these blocks will not be saved until the \u003Cem\u003ESave blocks\u003C\/em\u003E button is clicked.":"C\u00e1c thay \u0111\u1ed5i \u0111\u1ed1i v\u1edbi c\u00e1c kh\u1ed1i n\u1ed9i dung n\u00e0y s\u1ebd ch\u01b0a \u0111\u01b0\u1ee3c l\u01b0u cho \u0111\u1ebfn khi n\u00fat \u003Cem\u003EL\u01b0u c\u00e1c kh\u1ed1i n\u1ed9i dung\u003C\/em\u003E \u0111\u01b0\u1ee3c nh\u1ea5p.","Show shortcuts":"Hi\u1ec7n li\u00ean k\u1ebft nhanh","No revision":"Kh\u00f4ng c\u00f3 phi\u00ean b\u1ea3n n\u00e0o","@number comments per page":"@number l\u1eddi b\u00ecnh m\u1ed7i trang","Not restricted":"Kh\u00f4ng h\u1ea1n ch\u1ebf","Not customizable":"Ng\u01b0\u1eddi d\u00f9ng kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p t\u00f9y ch\u1ec9nh","Restricted to certain pages":"H\u1ea1n ch\u1ebf \u0111\u1ed1i v\u1edbi m\u1ed9t s\u1ed1 trang","The block cannot be placed in this region.":"Kh\u00f4ng th\u1ec3 \u0111\u01b0a kh\u1ed1i n\u00e0y v\u00e0o v\u00f9ng n\u00e0y.","Customize dashboard":"S\u1eeda c\u1ea5u h\u00ecnh kh\u1ed1i","Hide summary":"\u1ea8n t\u00f3m t\u1eaft","Edit summary":"S\u1eeda t\u00f3m t\u1eaft","@title dialog":"H\u1ed9p tho\u1ea1i @title","The selected file %filename cannot be uploaded. Only files with the following extensions are allowed: %extensions.":"T\u00ean t\u1ec7p %filename kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p t\u1ea3i l\u00ean. Ch\u1ec9 c\u00f3 c\u00e1c t\u1ec7p v\u1edbi ph\u1ea7n m\u1edf r\u1ed9ng sau l\u00e0 \u0111\u01b0\u1ee3c ph\u00e9p: %extensions.","Hide shortcuts":"\u1ea8n li\u00ean k\u1ebft nhanh","Directory":"Th\u01b0 m\u1ee5c","Please select a file.":"Vui l\u00f2ng ch\u1ecdn m\u1ed9t t\u1eadp tin.","You are not allowed to operate on more than %num files.":"B\u1ea1n kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p thao t\u00e1c nhi\u1ec1u h\u01a1n %num t\u1eadp tin.","Please specify dimensions within the allowed range that is from 1x1 to @dimensions.":"Vui l\u00f2ng x\u00e1c \u0111\u1ecbnh k\u00edch th\u01b0\u1edbc trong kho\u1ea3ng cho ph\u00e9p t\u1eeb 1x1 \u0111\u1ebfn @dimensions.","%filename is not an image.":"%filename kh\u00f4ng ph\u1ea3i l\u00e0 m\u1ed9t \u1ea3nh","Insert file":"Ch\u00e8n t\u1eadp tin v\u00e0o","Automatic alias":"\u0110\u01b0\u1eddng d\u1eabn \u1ea3o t\u1ef1 \u0111\u1ed9ng","Close":"\u0110\u00f3ng","On":"B\u1eadt","Off":"T\u1eaft","No name":"Kh\u00f4ng t\u00ean","Add @type":"Th\u00eam @type","Pause":"T\u1ea1m d\u1eebng","Feb":"Th2","Colorbox":"Colorbox","Do you want to refresh the current directory?":"B\u1ea1n c\u00f3 c\u00f3 mu\u1ed1n l\u00e0m t\u01b0\u01a1i th\u01b0 m\u1ee5c hi\u1ec7n h\u00e0nh?","Delete selected files?":"X\u00f3a c\u00e1c t\u1eadp tin \u0111\u00e3 ch\u1ecdn?","Please select a thumbnail.":"Vui l\u00f2ng ch\u1ecdn m\u1ed9t \u1ea3nh thu nh\u1ecf.","You must select at least %num files.":"B\u1ea1n ph\u1ea3i ch\u1ecdn \u00edt nh\u1ea5t %num t\u1eadp tin.","Downloads":"T\u1ea3i v\u1ec1","SKU":"SKU","Sell price":"Gi\u00e1 b\u00e1n","Shippable":"C\u00f3 th\u1ec3 chuy\u1ec3n","Total":"T\u1ed5ng","Authenticated users":"Ng\u01b0\u1eddi d\u00f9ng \u0111\u0103ng nh\u1eadp","Checkout is enabled.":"Thanh to\u00e1n \u0111\u00e3 \u0111\u01b0\u1ee3c b\u1eadt.","Anonymous checkout is enabled.":"Thanh to\u00e1n n\u1eb7c danh \u0111\u00e3 \u0111\u01b0\u1ee3c b\u1eadt.","Not shippable":"Kh\u00f4ng th\u1ec3 chuy\u1ec3n","Media browser":"Duy\u1ec7t t\u1ec7p tin","Total @type":"T\u1ed5ng s\u1ed1 @type","Percent":"Ph\u1ea7n tr\u0103m","Translatable":"Translatable","Using defaults":"S\u1eed d\u1ee5ng m\u1eb7c \u0111\u1ecbnh","Select All":"Ch\u1ecdn t\u1ea5t c\u1ea3","One domain with multiple subdomains":"M\u1ed9t t\u00ean mi\u1ec1n v\u1edbi nhi\u1ec1u t\u00ean mi\u1ec1n c\u1ea5p con","Multiple top-level domains":"Nhi\u1ec1u t\u00ean mi\u1ec1n ri\u00eang","All pages with exceptions":"T\u1ea5t c\u1ea3 trang v\u1edbi v\u00e0i lo\u1ea1i tr\u1eeb","A single domain":"T\u00ean mi\u1ec1n l\u1ebb"}} };;
/*!
	Colorbox 1.6.4
	license: MIT
	http://www.jacklmoore.com/colorbox
*/
(function(t,e,i){function n(i,n,o){var r=e.createElement(i);return n&&(r.id=Z+n),o&&(r.style.cssText=o),t(r)}function o(){return i.innerHeight?i.innerHeight:t(i).height()}function r(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==X[e]&&(this.cache[e]=X[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function h(t){var e=W.length,i=(A+t)%e;return 0>i?e+i:i}function a(t,e){return Math.round((/%/.test(t)?("x"===e?E.width():o())/100:1)*parseInt(t,10))}function s(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function l(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function d(t){"contains"in x[0]&&!x[0].contains(t.target)&&t.target!==v[0]&&(t.stopPropagation(),x.focus())}function c(t){c.str!==t&&(x.add(v).removeClass(c.str).addClass(t),c.str=t)}function g(e){A=0,e&&e!==!1&&"nofollow"!==e?(W=t("."+te).filter(function(){var i=t.data(this,Y),n=new r(this,i);return n.get("rel")===e}),A=W.index(_.el),-1===A&&(W=W.add(_.el),A=W.length-1)):W=t(_.el)}function u(i){t(e).trigger(i),ae.triggerHandler(i)}function f(i){var o;if(!G){if(o=t(i).data(Y),_=new r(i,o),g(_.get("rel")),!U){U=$=!0,c(_.get("className")),x.css({visibility:"hidden",display:"block",opacity:""}),I=n(se,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),b.css({width:"",height:""}).append(I),j=T.height()+k.height()+b.outerHeight(!0)-b.height(),D=C.width()+H.width()+b.outerWidth(!0)-b.width(),N=I.outerHeight(!0),z=I.outerWidth(!0);var h=a(_.get("initialWidth"),"x"),s=a(_.get("initialHeight"),"y"),l=_.get("maxWidth"),f=_.get("maxHeight");_.w=Math.max((l!==!1?Math.min(h,a(l,"x")):h)-z-D,0),_.h=Math.max((f!==!1?Math.min(s,a(f,"y")):s)-N-j,0),I.css({width:"",height:_.h}),J.position(),u(ee),_.get("onOpen"),O.add(F).hide(),x.focus(),_.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",d,!0),ae.one(re,function(){e.removeEventListener("focus",d,!0)})),_.get("returnFocus")&&ae.one(re,function(){t(_.el).focus()})}var p=parseFloat(_.get("opacity"));v.css({opacity:p===p?p:"",cursor:_.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),_.get("closeButton")?B.html(_.get("close")).appendTo(b):B.appendTo("<div/>"),w()}}function p(){x||(V=!1,E=t(i),x=n(se).attr({id:Y,"class":t.support.opacity===!1?Z+"IE":"",role:"dialog",tabindex:"-1"}).hide(),v=n(se,"Overlay").hide(),L=t([n(se,"LoadingOverlay")[0],n(se,"LoadingGraphic")[0]]),y=n(se,"Wrapper"),b=n(se,"Content").append(F=n(se,"Title"),R=n(se,"Current"),P=t('<button type="button"/>').attr({id:Z+"Previous"}),K=t('<button type="button"/>').attr({id:Z+"Next"}),S=t('<button type="button"/>').attr({id:Z+"Slideshow"}),L),B=t('<button type="button"/>').attr({id:Z+"Close"}),y.append(n(se).append(n(se,"TopLeft"),T=n(se,"TopCenter"),n(se,"TopRight")),n(se,!1,"clear:left").append(C=n(se,"MiddleLeft"),b,H=n(se,"MiddleRight")),n(se,!1,"clear:left").append(n(se,"BottomLeft"),k=n(se,"BottomCenter"),n(se,"BottomRight"))).find("div div").css({"float":"left"}),M=n(se,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),O=K.add(P).add(R).add(S)),e.body&&!x.parent().length&&t(e.body).append(v,x.append(y,M))}function m(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),f(this))}return x?(V||(V=!0,K.click(function(){J.next()}),P.click(function(){J.prev()}),B.click(function(){J.close()}),v.click(function(){_.get("overlayClose")&&J.close()}),t(e).bind("keydown."+Z,function(t){var e=t.keyCode;U&&_.get("escKey")&&27===e&&(t.preventDefault(),J.close()),U&&_.get("arrowKey")&&W[1]&&!t.altKey&&(37===e?(t.preventDefault(),P.click()):39===e&&(t.preventDefault(),K.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Z,"."+te,i):t("."+te).live("click."+Z,i)),!0):!1}function w(){var e,o,r,h=J.prep,d=++le;if($=!0,q=!1,u(he),u(ie),_.get("onLoad"),_.h=_.get("height")?a(_.get("height"),"y")-N-j:_.get("innerHeight")&&a(_.get("innerHeight"),"y"),_.w=_.get("width")?a(_.get("width"),"x")-z-D:_.get("innerWidth")&&a(_.get("innerWidth"),"x"),_.mw=_.w,_.mh=_.h,_.get("maxWidth")&&(_.mw=a(_.get("maxWidth"),"x")-z-D,_.mw=_.w&&_.w<_.mw?_.w:_.mw),_.get("maxHeight")&&(_.mh=a(_.get("maxHeight"),"y")-N-j,_.mh=_.h&&_.h<_.mh?_.h:_.mh),e=_.get("href"),Q=setTimeout(function(){L.show()},100),_.get("inline")){var c=t(e).eq(0);r=t("<div>").hide().insertBefore(c),ae.one(he,function(){r.replaceWith(c)}),h(c)}else _.get("iframe")?h(" "):_.get("html")?h(_.get("html")):s(_,e)?(e=l(_,e),q=_.get("createImg"),t(q).addClass(Z+"Photo").bind("error."+Z,function(){h(n(se,"Error").html(_.get("imgError")))}).one("load",function(){d===le&&setTimeout(function(){var e;_.get("retinaImage")&&i.devicePixelRatio>1&&(q.height=q.height/i.devicePixelRatio,q.width=q.width/i.devicePixelRatio),_.get("scalePhotos")&&(o=function(){q.height-=q.height*e,q.width-=q.width*e},_.mw&&q.width>_.mw&&(e=(q.width-_.mw)/q.width,o()),_.mh&&q.height>_.mh&&(e=(q.height-_.mh)/q.height,o())),_.h&&(q.style.marginTop=Math.max(_.mh-q.height,0)/2+"px"),W[1]&&(_.get("loop")||W[A+1])&&(q.style.cursor="pointer",t(q).bind("click."+Z,function(){J.next()})),q.style.width=q.width+"px",q.style.height=q.height+"px",h(q)},1)}),q.src=e):e&&M.load(e,_.get("data"),function(e,i){d===le&&h("error"===i?n(se,"Error").html(_.get("xhrError")):t(this).contents())})}var v,x,y,b,T,C,H,k,W,E,I,M,L,F,R,S,K,P,B,O,_,j,D,N,z,A,q,U,$,G,Q,J,V,X={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title},createImg:function(){var e=new Image,i=t(this).data("cbox-img-attrs");return"object"==typeof i&&t.each(i,function(t,i){e[t]=i}),e},createIframe:function(){var i=e.createElement("iframe"),n=t(this).data("cbox-iframe-attrs");return"object"==typeof n&&t.each(n,function(t,e){i[t]=e}),"frameBorder"in i&&(i.frameBorder=0),"allowTransparency"in i&&(i.allowTransparency="true"),i.name=(new Date).getTime(),i.allowFullscreen=!0,i}},Y="colorbox",Z="cbox",te=Z+"Element",ee=Z+"_open",ie=Z+"_load",ne=Z+"_complete",oe=Z+"_cleanup",re=Z+"_closed",he=Z+"_purge",ae=t("<a/>"),se="div",le=0,de={},ce=function(){function t(){clearTimeout(h)}function e(){(_.get("loop")||W[A+1])&&(t(),h=setTimeout(J.next,_.get("slideshowSpeed")))}function i(){S.html(_.get("slideshowStop")).unbind(s).one(s,n),ae.bind(ne,e).bind(ie,t),x.removeClass(a+"off").addClass(a+"on")}function n(){t(),ae.unbind(ne,e).unbind(ie,t),S.html(_.get("slideshowStart")).unbind(s).one(s,function(){J.next(),i()}),x.removeClass(a+"on").addClass(a+"off")}function o(){r=!1,S.hide(),t(),ae.unbind(ne,e).unbind(ie,t),x.removeClass(a+"off "+a+"on")}var r,h,a=Z+"Slideshow_",s="click."+Z;return function(){r?_.get("slideshow")||(ae.unbind(oe,o),o()):_.get("slideshow")&&W[1]&&(r=!0,ae.one(oe,o),_.get("slideshowAuto")?i():n(),S.show())}}();t[Y]||(t(p),J=t.fn[Y]=t[Y]=function(e,i){var n,o=this;return e=e||{},t.isFunction(o)&&(o=t("<a/>"),e.open=!0),o[0]?(p(),m()&&(i&&(e.onComplete=i),o.each(function(){var i=t.data(this,Y)||{};t.data(this,Y,t.extend(i,e))}).addClass(te),n=new r(o[0],e),n.get("open")&&f(o[0])),o):o},J.position=function(e,i){function n(){T[0].style.width=k[0].style.width=b[0].style.width=parseInt(x[0].style.width,10)-D+"px",b[0].style.height=C[0].style.height=H[0].style.height=parseInt(x[0].style.height,10)-j+"px"}var r,h,s,l=0,d=0,c=x.offset();if(E.unbind("resize."+Z),x.css({top:-9e4,left:-9e4}),h=E.scrollTop(),s=E.scrollLeft(),_.get("fixed")?(c.top-=h,c.left-=s,x.css({position:"fixed"})):(l=h,d=s,x.css({position:"absolute"})),d+=_.get("right")!==!1?Math.max(E.width()-_.w-z-D-a(_.get("right"),"x"),0):_.get("left")!==!1?a(_.get("left"),"x"):Math.round(Math.max(E.width()-_.w-z-D,0)/2),l+=_.get("bottom")!==!1?Math.max(o()-_.h-N-j-a(_.get("bottom"),"y"),0):_.get("top")!==!1?a(_.get("top"),"y"):Math.round(Math.max(o()-_.h-N-j,0)/2),x.css({top:c.top,left:c.left,visibility:"visible"}),y[0].style.width=y[0].style.height="9999px",r={width:_.w+z+D,height:_.h+N+j,top:l,left:d},e){var g=0;t.each(r,function(t){return r[t]!==de[t]?(g=e,void 0):void 0}),e=g}de=r,e||x.css(r),x.dequeue().animate(r,{duration:e||0,complete:function(){n(),$=!1,y[0].style.width=_.w+z+D+"px",y[0].style.height=_.h+N+j+"px",_.get("reposition")&&setTimeout(function(){E.bind("resize."+Z,J.position)},1),t.isFunction(i)&&i()},step:n})},J.resize=function(t){var e;U&&(t=t||{},t.width&&(_.w=a(t.width,"x")-z-D),t.innerWidth&&(_.w=a(t.innerWidth,"x")),I.css({width:_.w}),t.height&&(_.h=a(t.height,"y")-N-j),t.innerHeight&&(_.h=a(t.innerHeight,"y")),t.innerHeight||t.height||(e=I.scrollTop(),I.css({height:"auto"}),_.h=I.height()),I.css({height:_.h}),e&&I.scrollTop(e),J.position("none"===_.get("transition")?0:_.get("speed")))},J.prep=function(i){function o(){return _.w=_.w||I.width(),_.w=_.mw&&_.mw<_.w?_.mw:_.w,_.w}function a(){return _.h=_.h||I.height(),_.h=_.mh&&_.mh<_.h?_.mh:_.h,_.h}if(U){var d,g="none"===_.get("transition")?0:_.get("speed");I.remove(),I=n(se,"LoadedContent").append(i),I.hide().appendTo(M.show()).css({width:o(),overflow:_.get("scrolling")?"auto":"hidden"}).css({height:a()}).prependTo(b),M.hide(),t(q).css({"float":"none"}),c(_.get("className")),d=function(){function i(){t.support.opacity===!1&&x[0].style.removeAttribute("filter")}var n,o,a=W.length;U&&(o=function(){clearTimeout(Q),L.hide(),u(ne),_.get("onComplete")},F.html(_.get("title")).show(),I.show(),a>1?("string"==typeof _.get("current")&&R.html(_.get("current").replace("{current}",A+1).replace("{total}",a)).show(),K[_.get("loop")||a-1>A?"show":"hide"]().html(_.get("next")),P[_.get("loop")||A?"show":"hide"]().html(_.get("previous")),ce(),_.get("preloading")&&t.each([h(-1),h(1)],function(){var i,n=W[this],o=new r(n,t.data(n,Y)),h=o.get("href");h&&s(o,h)&&(h=l(o,h),i=e.createElement("img"),i.src=h)})):O.hide(),_.get("iframe")?(n=_.get("createIframe"),_.get("scrolling")||(n.scrolling="no"),t(n).attr({src:_.get("href"),"class":Z+"Iframe"}).one("load",o).appendTo(I),ae.one(he,function(){n.src="//about:blank"}),_.get("fastIframe")&&t(n).trigger("load")):o(),"fade"===_.get("transition")?x.fadeTo(g,1,i):i())},"fade"===_.get("transition")?x.fadeTo(g,0,function(){J.position(0,d)}):J.position(g,d)}},J.next=function(){!$&&W[1]&&(_.get("loop")||W[A+1])&&(A=h(1),f(W[A]))},J.prev=function(){!$&&W[1]&&(_.get("loop")||A)&&(A=h(-1),f(W[A]))},J.close=function(){U&&!G&&(G=!0,U=!1,u(oe),_.get("onCleanup"),E.unbind("."+Z),v.fadeTo(_.get("fadeOut")||0,0),x.stop().fadeTo(_.get("fadeOut")||0,0,function(){x.hide(),v.hide(),u(he),I.remove(),setTimeout(function(){G=!1,u(re),_.get("onClosed")},1)}))},J.remove=function(){x&&(x.stop(),t[Y].close(),x.stop(!1,!0).remove(),v.remove(),G=!1,x=null,t("."+te).removeData(Y).removeClass(te),t(e).unbind("click."+Z).unbind("keydown."+Z))},J.element=function(){return t(_.el)},J.settings=X)})(jQuery,document,window);;
/**
 * @file
 * Colorbox module init js.
 */

(function ($) {

Drupal.behaviors.initColorbox = {
  attach: function (context, settings) {
    if (!$.isFunction($.colorbox) || typeof settings.colorbox === 'undefined') {
      return;
    }

    if (settings.colorbox.mobiledetect && window.matchMedia) {
      // Disable Colorbox for small screens.
      var mq = window.matchMedia("(max-device-width: " + settings.colorbox.mobiledevicewidth + ")");
      if (mq.matches) {
        return;
      }
    }

    // Use "data-colorbox-gallery" if set otherwise use "rel".
    settings.colorbox.rel = function () {
      if ($(this).data('colorbox-gallery')) {
        return $(this).data('colorbox-gallery');
      }
      else {
        return $(this).attr('rel');
      }
    };

    $('.colorbox', context)
      .once('init-colorbox')
      .colorbox(settings.colorbox);

    $(context).bind('cbox_complete', function () {
      Drupal.attachBehaviors('#cboxLoadedContent');
    });
  }
};

})(jQuery);
;
/**
 * @file
 * Colorbox module style js.
 */

(function ($) {

Drupal.behaviors.initColorboxDefaultStyle = {
  attach: function (context, settings) {
    $(context).bind('cbox_complete', function () {
      // Only run if there is a title.
      if ($('#cboxTitle:empty', context).length == false) {
        $('#cboxLoadedContent img', context).bind('mouseover', function () {
          $('#cboxTitle', context).slideDown();
        });
        $('#cboxOverlay', context).bind('mouseover', function () {
          $('#cboxTitle', context).slideUp();
        });
      }
      else {
        $('#cboxTitle', context).hide();
      }
    });
  }
};

})(jQuery);
;
/**
 * @file
 * Colorbox module load js.
 */
(function ($) {

Drupal.behaviors.initColorboxLoad = {
  attach: function (context, settings) {
    if (!$.isFunction($.colorbox) || typeof settings.colorbox === 'undefined') {
      return;
    }

    if (settings.colorbox.mobiledetect && window.matchMedia) {
      // Disable Colorbox for small screens.
      var mq = window.matchMedia("(max-device-width: " + settings.colorbox.mobiledevicewidth + ")");
      if (mq.matches) {
        return;
      }
    }

    $.urlParams = function (url) {
      var p = {},
          e,
          a = /\+/g,  // Regex for replacing addition symbol with a space.
          r = /([^&=]+)=?([^&]*)/g,
          d = function (s) { return decodeURIComponent(s.replace(a, ' ')); },
          q = url.split('?');
      while (e = r.exec(q[1])) {
        e[1] = d(e[1]);
        e[2] = d(e[2]);
        switch (e[2].toLowerCase()) {
          case 'true':
          case 'yes':
            e[2] = true;
            break;
          case 'false':
          case 'no':
            e[2] = false;
            break;
        }
        if (e[1] == 'width') { e[1] = 'innerWidth'; }
        if (e[1] == 'height') { e[1] = 'innerHeight'; }
        p[e[1]] = e[2];
      }
      return p;
    };
    $('.colorbox-load', context)
      .once('init-colorbox-load', function () {
        var params = $.urlParams($(this).attr('href'));
        $(this).colorbox($.extend({}, settings.colorbox, params));
      });
  }
};

})(jQuery);
;
/* Helper function to be used globally */

/**
 * Get document.location.href string params.
 */
function custom_query_params_get() {
  var query = document.location.href.split(/\?/);
  var query_params = {};
                            
  if (query[1] != undefined && query[1] != '') {
    query = query[1].split(/\&/);
                              
    for (var i = 0; i < query.length; i++) {
      var params = query[i].split(/\=/);
      query_params[params[0]] = params[1];
    }
  }
  
  return query_params;
}

/**
 * Set a value to localStorage.
 */
function custom_variable_set(name, value) {
  if (localStorage != undefined) {
    localStorage.setItem(name, value);
  }
}

/**
 * Get a value from localStorage.
 */
function custom_variable_get(name, type) {
  if (localStorage != undefined) {
    var value = localStorage.getItem(name);
    
    if (value != null && type != undefined && type == 'json') {
      value = JSON.parse(value);
    }
    
    return value;
  }
  
  return null;
}

/**
 * Remove a value from localStorage.
 */
function custom_variable_remove(name) {
  localStorage.removeItem(name);
}

/**
 * Close the dialog confirm box.
 */
function custom_dialog_confirm_close() {
  if (jQuery("#custom-dialog-confirm").length) {
    jQuery("#custom-dialog-confirm").dialog("close");
  }
}

/**
 * Create / show a loading message for ajax processing.
 */
function custom_dialog_ajax_loading(title, message) {
  // Create a random id.
  var popup_id = 'custom-dialog-ajax-' + Date.now();
  
  // Remove if exist.
  if (jQuery("#" + popup_id).length) {
    jQuery("#" + popup_id).remove();
  }
  
  // Create dialog.
  jQuery('body').append('<div id="' + popup_id + '" title="' + title + '" style="display: none;"></div>');

  jQuery("#" + popup_id).dialog({
    modal: true,
    closeOnEscape: false,
    width: 400,
    height: 'auto',
    resizable: false,
    draggable: false,
    close: function(event, ui) {
      jQuery("#" + popup_id).remove();
    },
    open: function(event, ui) {
      jQuery(".ui-dialog-titlebar-close", ui.dialog | ui).hide();
    }
  });
  
  // Show the dialog.
  jQuery("#" + popup_id).html(message);
  jQuery("#" + popup_id).dialog('option', 'position', {my: "center center", at: "center", of: window});
  jQuery("#" + popup_id).dialog('open');
  
  return jQuery("#" + popup_id);
}

/**
 * Create / show a dialog box for message alert.
 */
function custom_dialog_alert(title, message, callback) {
  // Remove if exist.
  if (jQuery("#custom-dialog-alert").length) {
    jQuery("#custom-dialog-alert").remove();
  }
  
  // Build and process the form.
  jQuery('body').append('<div id="custom-dialog-alert" title="' + title + '" style="display: none;"></div>');
    
  jQuery("#custom-dialog-alert").dialog({
    modal: true,
    width: 400,
    height: 'auto',
    resizable: false,
    buttons: [
      {
        text: Drupal.t('OK'),
        class: 'custom-dialog primary',
        click: function() {
          if (typeof callback == 'function') {
            jQuery(this).dialog("close");
            callback();
          }
          else{
            jQuery(this).dialog("close");
          }
        }
      }
    ]
  });
  
  // Show the dialog.
  jQuery("#custom-dialog-alert").html(message);

  // Set position and show.
  jQuery("#custom-dialog-alert").dialog('option', 'position', {my: "center center", at: "center", of: window});
  jQuery("#custom-dialog-alert").dialog('open');
}

/**
 * Create / show a dialog box for message alert.
 */
function custom_dialog_confirm(title, message, width, height, has_cancel, callback) {
  if (jQuery("#custom-dialog-confirm").length) {
    jQuery("#custom-dialog-confirm").remove();
  }
  
  jQuery('body').append('<div id="custom-dialog-confirm" title="' + title + '" style="display: none;"></div>');
  jQuery("#custom-dialog-confirm").dialog({
    modal: true,
    width: width,
    height: height,
    resizable: false,
    close: function(event, ui) {
      jQuery("#custom-dialog-confirm").remove();
    },
    buttons: [
      {
        text: Drupal.t('OK'),
        class: 'custom-dialog primary',
        click: function() {
          if (typeof callback == 'function') {
            callback();
            
            // Will be handled in callback function.
            //jQuery(this).dialog("close");
          }
          else{
            jQuery(this).dialog("close");
          }
        }
      }
    ]
  });
  
  // Add cancel button.
  if (has_cancel) {
    jQuery("#custom-dialog-confirm").dialog('option', 'buttons', [
      {
        text: Drupal.t('OK'),
        class: 'custom-dialog primary',
        click: function() {
          if (typeof callback == 'function') {
            callback();
          }
          else{
            jQuery(this).dialog("close");
          }
        }
      },
      {
        text: Drupal.t('Cancel'),
        class: 'custom-dialog secondary',
        click: function() {
          jQuery(this).dialog("close");
        }      
      }
    ]);
  }
  
  // Show the dialog.
  jQuery("#custom-dialog-confirm").append(message);
  
  jQuery("[data-toggle=tooltip]:not('.processed')").each(function() {
    jQuery(this).tooltip();
    jQuery(this).addClass('processed');
  });
  
  // Set position and show.
  jQuery("#custom-dialog-confirm").dialog('option', 'position', {my: "center center", at: "center", of: window});
  jQuery("#custom-dialog-confirm").dialog('open');
}

/**
 * Auto change the number to currency.
 */
function custom_thousand_format_auto(obj) {
  var number = jQuery(obj).val().trim();
  
  // Convert string to number.
  var number_validated = custom_string_to_number(number);
  
  // Convert to currency format.
  jQuery(obj).val(custom_thousand_format(number_validated, ','));
}

/**
 * Auto convert string to number.
 */
function custom_number_format_auto(obj) {
  var number = jQuery(obj).val().trim();
  
  // Convert string to number.
  var number_validated = custom_string_to_number(number);
  
  // Convert to currency format.
  jQuery(obj).val(number_validated);
}

/**
 * Auto convert string to phone number.
 */
function custom_number_phone_format_auto(obj) {
  var number = jQuery(obj).val().trim();
  
  // Convert string to number.
  jQuery(obj).val(custom_string_to_number(number, true));
}

/**
 * Helper function to strip off all those are not number.
 */
function custom_string_to_number(string, is_phone) {
  if (is_phone == undefined) {is_phone = false;}
  
  var number_validated = '';
  for (var i = 0; i < string.length; i++) {
    if (parseInt(string.charAt(i)) >= 0) {
      number_validated += string.charAt(i);
    }
  }

  if (is_phone) {
    // Accept 0 at begining.
    return number_validated;
  }
  
  return parseInt(number_validated) ? parseInt(number_validated) : '';
}

/**
 * Helper function to formar number to VND currency.
 */
function custom_thousand_format(number, decimal_point = '.') {
  number += '';
  x = number.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;

  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + decimal_point + '$2');
  }
  return x1 + x2;
}

/**
 * Validate whether a text is valid email address.
 */
function custom_validate_is_email(email) {
  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
  return regex.test(email);
}

/**
 * Validate a mobile number.
 * Must add: drupal_add_js(drupal_get_path('module', 'custom') . '/js/giaidieu_mobilevn.js');
 */
function custom_validate_is_mobile_number(number) {
  // Process number.
  if (number.length != 10) {return false;}
  
  var number_prefix = number.substr(0, 3);
  
  for (var i = 0; i < mobile_data.length; i++) {
    var row = mobile_data[i];
    if (number_prefix == row.prefix) {
      return row.name;
    }
  }

  return false;
}

/**
 * Validate a URL.
 */
function custom_validate_is_url(url) {
  return /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);
}

/**
 * Helper function to send a service to server.
 */
function custom_services_request(service_name, params, callback) {
  try {
	  // Obtain session token.
		var token_url = "?q=services/session/token"
		jQuery.ajax({
		  url: token_url,
		  type: 'get',
		  dataType: 'text',
		  error:function (jqXHR, textStatus, errorThrown) {
				if (!errorThrown) {
				  errorThrown = Drupal.t('Token retrieval failed!');
				}
		  },
		  success: function(token) {
				// Call the web service.
				jQuery.ajax({
				  url: '/?q=drupalgap/drupalapp/' + service_name + '.json',
				  type: 'post',
				  data: params,
				  dataType: 'json',
				  beforeSend: function(request) {
						request.setRequestHeader("X-CSRF-Token", token);
				  },
				  error: function (jqXHR, textStatus, errorThrown) {
						console.log(arguments);
				  },
				  success: function(data) {
				    callback(data);
				  }
				});
		  }
		});
  }
  catch (error) { console.log('drupalgap service error - ' + error); }
}
;
/* custom.js file created by giaidieu */
var customer_default = null;

(function($){
	Drupal.behaviors.giaidieu_custom = {
		attach: function(context, settings) {
      if ($("body:not('.processed')").length) {
        // Remove pg list after order is sent.
        if ($("#custom-order-complete-wrapper").length) {
          custom_variable_remove('nyd_pg_list');
          _custom_update_favorite_cart();
        }
        
        // Store default customer to localstorage.
        if ($("#edit-customer-body").length) {
          customer_default = custom_variable_get('customer_default', 'json');
          if (customer_default == null) {
            if (Drupal.settings['customer_default'] != undefined) {
              custom_variable_set('customer_default', JSON.stringify(Drupal.settings['customer_default']));
              customer_default = custom_variable_get('customer_default', 'json');
            }
          }
          
          if (!$.isEmptyObject(customer_default)) {
            $("input[name='customer_name']").val(customer_default['customer_name']);
            $("input[name='customer_gender'][value='" + customer_default['customer_gender'] + "']").attr('checked', true);
            $("input[name='customer_age']").val(customer_default['customer_age']);
            $("input[name='customer_mobile']").val(customer_default['customer_mobile']);
            $("input[name='customer_email']").val(customer_default['customer_email']);
          }
        }
        
        // Update the pg list in contact us form.
        if ($("#edit-pgpb-body").length) {
          var list = custom_variable_get('nyd_pg_list', 'json');
          //console.log(list);
          
          if (list != null && list.length > 0) {
            // Get the list.
            var loading_message = _custom_dialog_ajax_loading();
            custom_services_request('contact_pg_list', {uids: list}, function(result) {
              //console.log(result);
              
              // Add to global variables.
              if (result['pg_services'] != undefined && !$.isEmptyObject(result['pg_services'])) {
                Drupal.settings['pg_services'] = result['pg_services'];
                //console.log(Drupal.settings['pg_services']);
                
                // Add service validation for PGs.
                $("#edit-appointment-service input[name='appointment_service']").each(function() {
                  // Validate messages.
                  var tid = $(this).val();

                  for (var uid in Drupal.settings['pg_services']) {
                    // Service.
                    if (Drupal.settings['pg_services'][uid][tid] == undefined && !$(this).parent().find('p.pg-validate-error[uid="' + uid + '"]').length) {
                      $(this).parent().append('<p class="pg-validate-error error" uid="' + uid + '"><b>' + Drupal.settings['pg_services'][uid]['pg_name'] + '</b> hiện không cung cấp dịch vụ này.</p>');
                    }
                  }
                });
              }
              
              loading_message.dialog('close');
              $("#edit-pgpb-body").html(result['output']);
              
              // Update the cart (remove those are no longer available).
              var new_list = new Array();
              for (var i = 0; i < list.length; i++) {
                if ($("span.list-pg[uid='" + list[i] + "']").length) {
                  new_list.push(list[i]);
                }
              }
              
              list = new_list;
              custom_variable_set('nyd_pg_list', JSON.stringify(list));
              _custom_update_favorite_cart();

              // Auto click for the first service.
              if ($("#edit-appointment-service-92").length) {
                setTimeout(function() {
                  $("#edit-appointment-service-92").trigger('click');
                }, 1000);
              }
            });
          }
          else{
            $("#edit-pgpb-body").html('Bạn chưa chọn PG / PB Hẹn hò để đăng ký thuê dịch vụ. <a href="/thanh-vien" title="Tìm người hẹn hò">Nhấn vào đây</a> để bắt đầu tìm.');
          }
        }
        
        // Update favorite cart item if any.
        if ($("span.cart-item-number").length) {
          _custom_update_favorite_cart();
        }
        
        // Add autocomplete places for Appointment address field.
        if ($("#edit-appointment-address").length && typeof google_map_autocomplete_init == 'function') {
          google_map_autocomplete_init('edit-appointment-address', function(google_map_place_autocomplete) {
            // Update when place changed.
            google_map_place_autocomplete.addListener('place_changed', function() {
              // Get the place details from the autocomplete object.
              var place = google_map_place_autocomplete.getPlace();
              //console.log(place);
            });
          });
        }
        
        // Setup datetime picker for Appointment form.
        if ($("#edit-appointment-datetime:not('.processed')").length) {
          $("#edit-appointment-datetime").datetimepicker({
            timepicker: true,
            format: 'd/m/Y H:i',
            step: 30,
            onShow: function(ct) {
              this.setOptions({
                minDate: new Date(Date.now() + (1 * 60 * 60 * 1000)), // 1 hour.
                minTime: new Date(Date.now() + (1 * 60 * 60 * 1000)),
                maxDate: new Date(Date.now() + (3 * 31 * 24 * 60 * 60 * 1000)) // 3 month.
              })
            },
            onSelectDate: function(ct) {
              var current_date = new Date();
              var min_time = new Date(Date.now() + (1 * 60 * 60 * 1000));
              
              if (ct.getFullYear() > current_date.getFullYear() || ct.getMonth() > current_date.getMonth() || ct.getDate() > current_date.getDate()) {
                min_time = '00:00';
              }
              
              this.setOptions({
                minTime: min_time
              })
            }
          });
          
          $.datetimepicker.setLocale('vi');
          
          $("#edit-appointment-datetime").addClass('processed');
        }
        
        // Auto click on the first tab for user profile form.
        if (!$("#page.webmaster-mode").length && ($("#user-register-form").length || $("#user-profile-form").length)) {
          giaidieu_user_profile_section('group-account');
          
          if (jQuery("#edit-field-birthdate-und-0-value-datepicker-popup-0").length) {
            jQuery("#edit-field-birthdate-und-0-value-datepicker-popup-0").change(function() {
              custom_validate_user_birthdate_callback(this);
            });
          }
          
          if (jQuery("div.form-type-password-confirm").length) {
            jQuery("#edit-pass-pass1, #edit-pass-pass2").blur(function() {
              custom_validate_user_pass_callback(this);
            });
          }
          
          // Show / hide for so do 3 vong.
          var gender = jQuery("#edit-field-gender-und input[type='radio']:checked").attr('value');
          if (gender == 1) {
            $("#edit-field-sodo").fadeOut();
          }
          else{
            $("#edit-field-sodo").fadeIn();
          }
          
          $("#edit-field-gender-und input[type='radio']").click(function() {
            if ($(this).val() == 1) {
              $("#edit-field-sodo").fadeOut();
            }
            else{
              $("#edit-field-sodo").fadeIn();
            }
            
            return true;
          });
        }
        
        // Add autocomplete places for Address field.
        if ($("#edit-field-address-und-0-value").length && typeof google_map_autocomplete_init == 'function') {
          google_map_autocomplete_init('edit-field-address-und-0-value', function(google_map_place_autocomplete) {
            // Update when place changed.
            google_map_place_autocomplete.addListener('place_changed', function() {
              // Get the place details from the autocomplete object.
              var place = google_map_place_autocomplete.getPlace();
              //console.log(place);

              $("#edit-field-geocode-und-0-geom-lat").val(place.geometry.location.lat());
              $("#edit-field-geocode-und-0-geom-lon").val(place.geometry.location.lng());
            });
          });
        }

        $("body").addClass('processed');
      }
		}
  };
})(jQuery);
;
/* Custom function made by giaidieu.com */

/**
 * Smart login callback.
 */
function custom_user_smart_login(obj) {
  var name = jQuery('#edit-name').val().trim();
  var pass = jQuery('#edit-pass').val().trim();
  
  if (name == '' || pass == '') {
    custom_dialog_alert('Thông báo', 'Bạn chưa nhập đầy đủ thông tin để đăng nhập. Vui lòng kiểm tra rồi thử lại.');
    return false;
  }


  jQuery(obj).addClass('disabled');
  var message_loading = custom_dialog_ajax_loading('Đang xử lý đăng nhập...', 'Xin vui lòng chờ trong giây lát!');
  
  custom_services_request('account_smart_login', {name: name, password: pass}, function(result) {
    //console.log(result);
    
    jQuery(obj).removeClass('disabled');
    message_loading.dialog('close');
    
    if (result['is_error']) {
      custom_dialog_alert('Thông báo', result['message']);
      return false;
    }
    
    // Successful login.
    custom_dialog_alert('Thông báo', 'Bạn đã đăng nhập thành công vào Người Yêu Đẹp bằng <b>' + result['login_type'] + '</b> để sử dụng dịch vụ. Nhấn "Đồng ý" để tiếp tục.', function() {
      // Check if there is a destination, if has, go for it.
      var query_params = custom_query_params_get();
      if (query_params['destination'] != undefined && query_params['destination'] != '') {
        document.location.href = '/' + query_params['destination'];
      }
      else{
        document.location.reload();
      }
    });
  });
  
  return false;
}

/**
 * Auto login and redirect for social network account.
 */
function custom_social_network_login(response) {
  var message_loading = custom_dialog_ajax_loading('Đang xử lý đăng nhập...', 'Xin vui lòng chờ trong giây lát!');
  response['status'] = 0; // Not activate by detault -> Wait for selecting role.
              
  custom_services_request('social_login', {data: response}, function(result) {
    message_loading.dialog('close');
                
    if (result && result['uid'] > 0) {
      if (result['is_new']) {
        // For new account, ask for role and go to update profile.
        var html = '<p class="desc">Bạn đã đăng ký thành công vào Người Yêu Đẹp. Vui lòng chọn loại tài khoản để tiếp tục:</p>';
        html += '<input type="radio" name="account_type" value="5" /> Khách thuê dịch vụ<br /><input type="radio" name="account_type" value="4" /> PG/PB cung cấp dịch vụ';
                    
        custom_dialog_confirm('Chọn loại tài khoản', html, 400, 'auto', false, function() {
          var account_type = parseInt(jQuery("#custom-dialog-confirm").find('input[name="account_type"]:checked').val());
          if (account_type != 4 && account_type != 5) {
            custom_dialog_alert('Thông báo', 'Bạn chưa chọn loại tài khoản để tiếp tục.');
            return false;
          }
                      
          // Process to assign role.
          custom_dialog_confirm_close();
                      
          var account_fields = {
            status: 1,
            login: 1
          };
                      
          if (account_type == 5) {
            account_fields['roles'] = {5: 'customer'};
          }
          else{
            account_fields['roles'] = {4: 'pgpb'};
          }
                      
          var message_loading = custom_dialog_ajax_loading('Đang xử lý...', 'Xin vui lòng chờ trong giây lát!');
          custom_services_request('user_store', {uid: result['uid'], account_fields: account_fields}, function(result) {
            //console.log(result);
                        
            message_loading.dialog('close');
                        
            if (result['is_error']) {
              custom_dialog_alert('Thông báo', result['message']);
              return false;                          
            }
                        
            if (account_type == 4) {
              // PG account is not activated automatically.
              custom_dialog_alert('Thông báo', '<p>Là thành viên cung cấp dịch vụ, bạn cần điền đầy đủ thông tin trong mục <b>"Cập Nhật Hồ Sơ"</b> và thực hiện xác thực E-mail / Số điện thoại để nhận yêu cầu từ Khách hàng.</p><p>Sau khi hoàn thành, tài khoản của bạn sẽ được duyệt bởi Người Yêu Đẹp để hiện lên website.</p><p>Nhấn "Đồng ý" để tiếp tục.</p>', function() {
                document.location.href = '/user/' + result['account']['uid'] + '/edit';
              });
            }
            else{
              custom_dialog_alert('Thông báo', 'Bạn đã đăng nhập thành công vào Người Yêu Đẹp để sử dụng dịch vụ dành riêng cho tài khoản Khách hàng. Nhấn "Đồng ý" để tiếp tục.', function() {
                // Check if there is a destination, if has, go for it.
                var query_params = custom_query_params_get();
                if (query_params['destination'] != undefined && query_params['destination'] != '') {
                  document.location.href = '/' + query_params['destination'];
                }
                else{
                  document.location.href = '/user';
                }
              });
            }
          });
        });
      }
      else{
        // Check if there is a destination, if has, go for it.
        var query_params = custom_query_params_get();
        if (query_params['destination'] != undefined && query_params['destination'] != '') {
          document.location.href = '/' + query_params['destination'];
        }
        else{
          document.location.href = '/user';
        }
      }
    }
  });
}

/**
 * Remove a pg uid from the list in contact display.
 */
function custom_pg_list_remove(obj) {
  var uid = parseInt(jQuery(obj).attr('uid'));
  var name = jQuery(obj).attr('title');
  
  // Validate.
  if (isNaN(uid)) {return;}

  // Remove from the list.
  _custom_remove_from_favorite(uid, name, function() {
    // Remove from the display.
    jQuery(obj).closest('div.views-row').fadeOut(function() {
      // Remove.
      jQuery(this).remove();
      
      // Display empty text if no more.
      if (jQuery("#edit-pgpb-body").find('div.view-content').children().length == 0) {
        jQuery("#edit-pgpb-body").html('Bạn chưa chọn PG / PB Hẹn hò để đăng ký thuê dịch vụ. <a href="/thanh-vien" title="Tìm người hẹn hò">Nhấn vào đây</a> để bắt đầu tìm.');
      }
      
      // Update PG list.
      if (Drupal.settings['pg_services'] != undefined && Drupal.settings['pg_services'][uid] != undefined) {
        delete Drupal.settings['pg_services'][uid];
        
        // Update messages.
        jQuery("p.pg-validate-error[uid='" + uid + "']").remove();
        jQuery("p.pg-validate-warning[uid='" + uid + "']").remove();
        
        if (!jQuery("#appointment-duration-update").children('p.pg-validate-warning').length) {
          jQuery("#appointment-duration-update").remove();
        }
      }
    });
  });
  
  return false;
}

/**
 * Remove an item from the pg list.
 */
function _custom_remove_from_favorite(uid, name, callback) {
  custom_dialog_confirm('Xác nhận', 'Bạn chắc chắn muốn đưa ' + name + ' ra khỏi Danh sách chọn của mình?', 400, 'auto', true, function() {
    // Close the box.
    custom_dialog_confirm_close();
    
    // Get the list if existing.
    var list = custom_variable_get('nyd_pg_list', 'json');
    if (list == null) {
      list = new Array();
    }
    
    // Remove from the list.
    var list_new = new Array();
    for (var i = 0; i < list.length; i++) {
      if (parseInt(list[i]) != parseInt(uid)) {
        list_new.push(list[i]);
      }
    }
    
    custom_variable_set('nyd_pg_list', JSON.stringify(list_new));
    custom_dialog_alert('Thông báo', name + ' đã được đưa ra khỏi Danh sách chọn của bạn.');
    
    // Update the cart.
    _custom_update_favorite_cart();
    
    if (typeof callback == 'function') {
      callback();
    }
  });
}

/**
 * Check to see if a PG is in the list.
 */
function _custom_exist_in_favorite(uid) {
  // Get the list if existing.
  var list = custom_variable_get('nyd_pg_list', 'json');
  if (list == null) {
    list = new Array();
  }
  
  return jQuery.inArray(uid, list) != -1 ? true : false;
}

/**
 * Add an item to favorite list.
 */
function _custom_add_to_favorite(uid, name, callback) {
  if (_custom_exist_in_favorite(uid)) {
    custom_dialog_alert('Thông báo', name + ' đã nằm trong Danh sách chọn rồi. Bạn không cần phải làm lại.');
  }
  else{
    custom_dialog_confirm('Xác nhận', 'Bạn chắc chắn muốn đưa ' + name + ' vào Danh sách chọn của mình?', 400, 'auto', true, function() {
      // Close the box.
      custom_dialog_confirm_close();
    
      // Get the list if existing.
      var list = custom_variable_get('nyd_pg_list', 'json');
      if (list == null) {
        list = new Array();
      }
  
      // Add to the list if not existing.
      list.push(uid);
      custom_variable_set('nyd_pg_list', JSON.stringify(list));
      custom_dialog_alert('Thông báo', name + ' đã được đưa vào Danh sách chọn của bạn.');
      
      // Update the cart number.
      _custom_update_favorite_cart();
      
      // Execute callback function.
      if (typeof callback == 'function') {
        callback();
      }
    });
  }
  
  return false;
}

/**
 * Update the favorite cart items in the display.
 */
function _custom_update_favorite_cart() {
  var list = custom_variable_get('nyd_pg_list', 'json');
  var item_number = list != null ? list.length : 0;
  
  if (item_number > 0) {
    jQuery("span.cart-item-number").html(item_number);
  }
  else{
    jQuery("span.cart-item-number").html('');
  }
}

/**
 * Add to favorite list.
 */
function custom_add_to_favorite(obj) {
  var uid = parseInt(jQuery(obj).attr('uid'));
  var name = jQuery(obj).attr('title');
  if (isNaN(uid)) {return;}
  
  _custom_add_to_favorite(uid, name);
  return false;
}

/**
 * Add then go to contact us page.
 */
function custom_buy_now(obj) {
  var uid = parseInt(jQuery(obj).attr('uid'));
  var name = jQuery(obj).attr('title');
  if (isNaN(uid)) {return;}

  // Add to the list first.
  if (_custom_exist_in_favorite(uid)) {
    document.location.href = '/lien-he-thue-nguoi-yeu';
  }
  else{
    _custom_add_to_favorite(uid, name, function() {
      document.location.href = '/lien-he-thue-nguoi-yeu';
    });
  }
  
  return false;
}

/**
 * Verify mobile in mobile number field.
 */
function giaidieu_user_verify_mobile(obj) {
  var current_mobile = jQuery("input[name='current_mobile']").val().trim();
  var uid = jQuery("input[name='current_uid']").val();
  
  custom_dialog_confirm('Thông báo', 'Vui lòng nhấn "Đồng ý" để bắt đầu xác thực số điện thoại hiện tại của bạn.', 400, 'auto', true, function() {
    // Generate code and waiting for input.
    jQuery(obj).attr('disabled', true);
    var loading_message = _custom_dialog_ajax_loading();
    
    custom_services_request('verify_code_generate', {name: current_mobile}, function(result) {
      jQuery(obj).attr('disabled', false);
      loading_message.dialog('close');
            
      // Error.
      if (result['is_error']) {
        custom_dialog_alert('Thông báo', result['message']);
        return false;
      }
          
      // Display a popup for entering code.
      var message = '<p>Vui lòng kiểm tra tin nhắn SMS số điện thoại <i>' + current_mobile + '</i> để lấy mã xác thực nhập vào hộp dưới đây:</p>';
      message += '<input type="number" name="code" value="" placeholder="Mã xác thực" class="form-control" />';
        
      custom_dialog_confirm('Xác thực số điện thoại', message, 400, 'auto', false, function() {
        // Validate.
        var popup = jQuery("#custom-dialog-confirm");
        var code = popup.find('input[name="code"]').val().trim();
        if (code == '') {
          custom_dialog_alert('Thông báo', 'Vui lòng nhập mã xác thực để tiếp tục.');
          return false;
        }
          
        // Send to server for processing.
        var button = popup.find('button[name="submit"]');
        jQuery(button).attr('disabled', true);
        var loading_message2 = _custom_dialog_ajax_loading();

        custom_services_request('pass_code_verify', {uid: uid, code: code, is_activation: 0}, function(result) {
          jQuery(button).attr('disabled', false);
          loading_message2.dialog('close');

          // Error.
          if (result['is_error']) {
            custom_dialog_alert('Thông báo', result['message']);
            return false;
          }

          // Call to server for update.
          var account_fields = {
            'field_mobile_is_verified': {'value': 1}
          };
              
          jQuery(obj).attr('disabled', true);
          var loading_message3 = _custom_dialog_ajax_loading();
          
          custom_services_request('user_store', {uid: uid, account_fields: account_fields}, function(data) {
            jQuery(obj).attr('disabled', false);
            loading_message3.dialog('close');
      
            if (data['is_error']) {
              custom_dialog_alert('Thông báo', data['message']);
              return false;
            }
                
            // Verify confirmed. Close the popup.
            popup.dialog('close');
            custom_dialog_alert('Thông báo', 'Số điện thoại của bạn đã được xác thực thành công. Xin chân thành cám ơn.');

            // Change email verify hidden field value.
            jQuery("#edit-field-mobile-is-verified input").val('1');

            jQuery("span.verify-status.mobile").html('<i class="fa fa-check-circle verified" aria-hidden="true"></i> <button type="button" class="btn btn-default" onclick="giaidieu_user_change_mobile(this); return false;">Đổi số mới</button>');
            jQuery("#edit-field-mobile-number-und-0-value").attr('readonly', true);
          });
        });
      });
    });
  });
  
  return false;
}

/**
 * Change mobile in mobile number field.
 */
function giaidieu_user_change_mobile(obj) {
  // Check mode.
  var mode_is_lock = jQuery("#edit-field-mobile-number-und-0-value").attr('readonly') ? true : false;
  var current_mobile = jQuery("input[name='current_mobile']").val();
  var uid = jQuery("input[name='current_uid']").val();

  if (!mode_is_lock) {
    // Unlock mode, allow to change new email.
    var mobile = jQuery("#edit-field-mobile-number-und-0-value").val().trim().replace(/\s+/g, '');

    if (mobile == '' || !custom_validate_is_mobile_number(mobile)) {
      custom_dialog_alert('Thông báo', 'Xin vui lòng nhập Số điện thoại hợp lệ của bạn để thực hiện đổi.');
      return false;
    }
    
    if (mobile == current_mobile) {
      custom_dialog_alert('Thông báo', 'Số điện thoại mới của bạn trùng với số hiện đang dùng. Vui lòng kiểm tra.');
      return false;
    }

    var account_fields = {
      'field_mobile_number': {'value': mobile},
      'field_mobile_is_verified': {'value': 0}
    };

    // Call to server for update.
    jQuery(obj).attr('disabled', true);
    var loading_message = _custom_dialog_ajax_loading();
    
    custom_services_request('user_store', {uid: uid, account_fields: account_fields}, function(data) {
      jQuery(obj).attr('disabled', false);
      loading_message.dialog('close');
      
      if (data['is_error']) {
        custom_dialog_alert('Thông báo', data['message']);
        
        // Reset back to old number.
        jQuery("#edit-field-mobile-number-und-0-value").val(current_mobile);
      }
      else {
        // Reload the user mobile.
        jQuery("input[name='current_mobile']").val(data['account']['field_mobile_number']['und'][0]['value']);
        custom_dialog_alert('Thông báo', 'Số điện thoại mới của bạn đã được cập nhật thành công.');
        
        // Lock the field. - unverify no need to lock.
        //jQuery("#edit-field-mobile-number-und-0-value").attr('readonly', true);

        // Change status to unverified.
        jQuery("span.verify-status.mobile").html('<i class="fa fa-times unverified" aria-hidden="true"></i> <button class="btn btn-inline btn-verify" onclick="giaidieu_user_verify_mobile(this); return false;">Xác thực ngay</button> <button type="button" class="btn btn-default" onclick="giaidieu_user_change_mobile(this); return false;">Đổi số mới</button>');
      }
    });
  }
  else{
    custom_dialog_confirm('Xác nhận', 'Vui lòng nhấn "Đồng ý" để thực hiện xác thực yêu cầu đổi số điện thoại của bạn.', 400, 'auto', true, function() {
      // Generate code and waiting for input.
      jQuery(obj).attr('disabled', true);
      var loading_message = _custom_dialog_ajax_loading();
      
      custom_services_request('verify_code_generate', {name: current_mobile}, function(result) {
        jQuery(obj).attr('disabled', false);
        loading_message.dialog('close');
            
        // Error.
        if (result['is_error']) {
          custom_dialog_alert('Thông báo', result['message']);
          return false;
        }
          
        // Display a popup for entering code.
        var message = '<p>Vui lòng kiểm tra tin nhắn SMS số điện thoại <i>' + current_mobile + '</i> để lấy mã xác thực nhập vào hộp dưới đây:</p>';
        message += '<input type="number" name="code" value="" placeholder="Mã xác thực" class="form-control" />';
        
        custom_dialog_confirm('Xác thực số điện thoại', message, 400, 'auto', false, function() {
          // Validate.
          var popup = jQuery("#custom-dialog-confirm");
          var code = popup.find('input[name="code"]').val().trim();
          if (code == '') {
            custom_dialog_alert('Thông báo', 'Vui lòng nhập mã xác thực để tiếp tục.');
            return false;
          }
          
          // Send to server for processing.
          var button = popup.find('button[name="submit"]');
          jQuery(button).attr('disabled', true);
          var loading_message2 = _custom_dialog_ajax_loading();

          custom_services_request('pass_code_verify', {uid: uid, code: code, is_activation: 0}, function(result) {
            jQuery(button).attr('disabled', false);
            loading_message2.dialog('close');

            // Error.
            if (result['is_error']) {
              custom_dialog_alert('Thông báo', result['message']);
              return false;
            }
              
            // Verify confirmed. unlock the email field for changing.
            popup.dialog('close');
            custom_dialog_alert('Thông báo', 'Xác thực đã hoàn thành! Vui lòng nhấn "Đồng ý" để thực hiện đổi số trong hộp "Số di động".');
              
            jQuery("#edit-field-mobile-number-und-0-value").attr('readonly', false);
            jQuery("#edit-field-mobile-number-und-0-value").focus();
          });
        });
      });
    });
  }
  
  return false;
}

/**
 * Process to change email in email field.
 */
function giaidieu_user_change_email(obj) {
  // Check mode.
  var mode_is_lock = jQuery("#edit-mail").attr('readonly') ? true : false;
  var current_email = jQuery("input[name='current_email']").val();
  var uid = jQuery("input[name='current_uid']").val();

  if (!mode_is_lock) {
    // Unlock mode, allow to change new email.
    var email = jQuery("#edit-mail").val().trim();
    email = email.toLowerCase();

    if (email == '' || !custom_validate_is_email(email)) {
      custom_dialog_alert('Thông báo', 'Xin vui lòng nhập Địa chỉ e-mail hợp lệ của bạn để thực hiện đổi.');
      return false;
    }
    
    if (email == current_email) {
      custom_dialog_alert('Thông báo', 'Địa chỉ e-mail mới của bạn trùng với địa chỉ hiện đang dùng. Vui lòng kiểm tra.');
      return false;
    }

    var account_fields = {
      'email': email,
      'field_email_is_verified': {'value': 0}
    };

    // Call to server for update.
    jQuery(obj).attr('disabled', true);
    var loading_message = _custom_dialog_ajax_loading();
    
    custom_services_request('user_store', {uid: uid, account_fields: account_fields}, function(data) {
      jQuery(obj).attr('disabled', false);
      loading_message.dialog('close');
      
      if (data['is_error']) {
        custom_dialog_alert('Thông báo', data['message']);
        jQuery("#edit-mail").val(current_email);
      }
      else {
        // Reload the user profile.
        //console.log(data);
        
        jQuery("input[name='current_email']").val(data['account'].mail);
        custom_dialog_alert('Thông báo', 'Địa chỉ e-mail mới của bạn đã được cập nhật thành công.');
        
        // Lock the field. no locking unverified e-mail address. 
        //jQuery("#edit-mail").attr('readonly', true);
        
        // Change status to unverified.
        jQuery("span.verify-status.email").html('<i class="fa fa-times unverified" aria-hidden="true"></i> <button class="btn btn-inline btn-verify" onclick="giaidieu_user_verify_email(this); return false;">Xác thực ngay</button> <button type="button" class="btn btn-default" onclick="giaidieu_user_change_email(this); return false;">Đổi e-mail</button>');
      }
    });
  }
  else{
    custom_dialog_confirm('Xác nhận', 'Vui lòng nhấn "Đồng ý" để thực hiện xác thực yêu cầu đổi e-mail của bạn.', 400, 'auto', true, function() {
      // Generate code and waiting for input.
      jQuery(obj).attr('disabled', true);
      var loading_message = _custom_dialog_ajax_loading();
      
      custom_services_request('verify_code_generate', {name: current_email}, function(result) {
        jQuery(obj).attr('disabled', false);
        loading_message.dialog('close');

        // Error.
        if (result['is_error']) {
          custom_dialog_alert('Thông báo', result['message']);
          return false;
        }
          
        // Display a popup for entering code.
        var message = '<p>Vui lòng kiểm tra e-mail của bạn địa chỉ <i>' + current_email + '</i> để lấy mã xác thực nhập vào hộp dưới đây:</p>';
        message += '<input type="number" name="code" value="" placeholder="Mã xác thực" class="form-control" />';
        
        custom_dialog_confirm('Xác thực e-mail', message, 400, 'auto', false, function() {
          // Validate
          var popup = jQuery("#custom-dialog-confirm");

          var code = popup.find('input[name="code"]').val().trim();
          if (code == '') {
            custom_dialog_alert('Thông báo', 'Vui lòng nhập mã xác thực để tiếp tục.');
            return false;
          }
          
          // Send to server for processing.
          var button = popup.find('button[name="submit"]');
          jQuery(button).attr('disabled', true);
          var loading_message2 = _custom_dialog_ajax_loading();

          custom_services_request('pass_code_verify', {uid: uid, code: code, is_activation: 0}, function(result) {
            jQuery(button).attr('disabled', false);
            loading_message2.dialog('close');

            // Error.
            if (result['is_error']) {
              popup.find('input[name="code"]').val('');
              custom_dialog_alert('Thông báo', result['message']);
              return false;
            }
              
            // Verify confirmed. unlock the email field for changing.
            custom_dialog_alert('Thông báo', 'Xác thực đã hoàn thành! Vui lòng nhấn "Đồng ý" để thực hiện đổi e-mail trong hộp "Địa chỉ e-mail".');
            popup.dialog('close');
              
            jQuery("#edit-mail").attr('readonly', false);
            jQuery("#edit-mail").focus();
          });
        });
      });
    });
  }
  
  return false;
}

/**
 * Process to verify an email in email field.
 */
function giaidieu_user_verify_email(obj) {
  var current_email = jQuery("input[name='current_email']").val();
  var uid = jQuery("input[name='current_uid']").val();
  
  custom_dialog_confirm('Xác nhận', 'Vui lòng nhấn "Đồng ý" để bắt đầu xác thực địa chỉ e-mail hiện tại của bạn.', 400, 'auto', true, function() {
    // Generate code and waiting for input.
    jQuery(obj).attr('disabled', true);
    var loading_message = _custom_dialog_ajax_loading();
    
    custom_services_request('verify_code_generate', {name: current_email}, function(result) {
      jQuery(obj).attr('disabled', false);
      loading_message.dialog('close');
            
      // Error.
      if (result['is_error']) {
        custom_dialog_alert('Thông báo', result['message']);
        return false;
      }

      // Display a popup for entering code.
      var message = '<p>Vui lòng kiểm tra e-mail của bạn địa chỉ <i>' + current_email + '</i> để lấy mã xác thực nhập vào hộp dưới đây:</p>';
      message += '<input type="number" name="code" value="" placeholder="Mã xác thực" class="form-control" />';
        
      custom_dialog_confirm('Xác thực e-mail', message, 400, 'auto', false, function() {
        // Validate.
        var popup = jQuery("#custom-dialog-confirm");

        var code = popup.find('input[name="code"]').val().trim();
        if (code == '') {
          custom_dialog_alert('Thông báo', 'Vui lòng nhập mã xác thực để tiếp tục.');
          return false;
        }

        // Send to server for processing.
        var button = popup.find('button[name="submit"]');
        jQuery(button).attr('disabled', true);
        var loading_message2 = _custom_dialog_ajax_loading();

        custom_services_request('pass_code_verify', {uid: uid, code: code, is_activation: 0}, function(result) {
          jQuery(button).attr('disabled', false);
          loading_message2.dialog('close');

          // Error.
          if (result['is_error']) {
            popup.find('input[name="code"]').val('');
            custom_dialog_alert('Thông báo', result['message']);
            return false;
          }

          // Call to server for update.
          var account_fields = {
            'field_email_is_verified': {'value': 1}
          };

          jQuery(obj).attr('disabled', true);
          var loading_message3 = _custom_dialog_ajax_loading();
          
          custom_services_request('user_store', {uid: uid, account_fields: account_fields}, function(data) {
            jQuery(obj).attr('disabled', false);
            loading_message3.dialog('close');
      
            if (data['is_error']) {
              custom_dialog_alert('Thông báo', data['message']);
              return false;
            }
                
            // Verify confirmed. Close the popup.
            popup.dialog('close');
            custom_dialog_alert('Thông báo', 'Địa chỉ e-mail của bạn đã được xác thực thành công. Xin chân thành cám ơn.');

            // Change email verify hidden field value.
            jQuery("#edit-field-email-is-verified input").val('1');

            jQuery("span.verify-status.email").html('<i class="fa fa-check-circle verified" aria-hidden="true"></i> <button type="button" class="btn btn-default" onclick="giaidieu_user_change_email(this); return false;">Đổi e-mail</button>');
            jQuery("#edit-mail").attr('readonly', true);
          });
        });
      });
    });
  });
  
  return false;
}

/**
 * Process to validate / submit whole form of appointment.
 */
function custom_appointment_form_submit_callback(obj) {
  // Get all values.
  var customer_name = jQuery("input[name='customer_name']").val().trim();
  var customer_gender = jQuery("input[name='customer_gender']:checked").val();
  var customer_age = parseInt(jQuery("input[name='customer_age']").val().trim().replace(/\s+/g, ''));
  var customer_mobile = jQuery("input[name='customer_mobile']").val().trim().replace(/\s+/g, '');
  var customer_email = jQuery("input[name='customer_email']").val().trim().replace(/\s+/g, '');
  
  var appointment_service = parseInt(jQuery("input[name='appointment_service']:checked").val());
  var appointment_datetime = jQuery("input[name='appointment_datetime']").val().trim();
  var appointment_duration = jQuery("input[name='appointment_duration']").val().trim();
  var appointment_city = jQuery("select[name='appointment_city']").val();
  var appointment_address = jQuery("input[name='appointment_address']").val().trim();
  
  // Get pg list.
  var pg_list = new Array();
  
  var captcha = jQuery("input[name='captcha_response']").length ? jQuery("input[name='captcha_response']").val().trim() : '';
  
  var container = jQuery("#custom-contact-us-form");

  // Validate all.
  if (customer_name == '') {
    _custom_form_set_error(jQuery("input[name='customer_name']"), true, 'Vui lòng nhập tên của bạn để tiện liên hệ.');
    _custom_scroll_to(container, jQuery("input[name='customer_name']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='customer_name']"), false, 'Vui lòng nhập tên của bạn để tiện liên hệ.');
  }
  
  if (customer_gender == undefined) {
    _custom_form_set_error(jQuery("#edit-customer-gender"), true, 'Vui lòng chọn giới tính của bạn.');
    _custom_scroll_to(container, jQuery("#edit-customer-gender"));
    return false;    
  }
  else{
    _custom_form_set_error(jQuery("#edit-customer-gender"), false, '');
  }

  if (isNaN(customer_age) || customer_age < 18 || customer_age > 65) {
    _custom_form_set_error(jQuery("input[name='customer_age']"), true, 'Số tuổi của bạn không phù hợp. Xin vui lòng kiểm tra.');
    _custom_scroll_to(container, jQuery("input[name='customer_age']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='customer_age']"), false, 'Nhập tuổi của bạn để PG/PB tiếp đón phù hợp. Bạn phải từ 18 tuổi trở lên để có thể sử dụng dịch vụ.');
  }

  if (customer_mobile == '' || !custom_validate_is_mobile_number(customer_mobile)) {
    _custom_form_set_error(jQuery("input[name='customer_mobile']"), true, 'Số điện thoại không đúng. Xin vui lòng kiểm tra.');
    _custom_scroll_to(container, jQuery("input[name='customer_mobile']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='customer_mobile']"), false, 'QUAN TRỌNG: Số di động đúng để nhận tin xác thực giao dịch.');
  }

  if (customer_email == '' || !custom_validate_is_email(customer_email)) {
    _custom_form_set_error(jQuery("input[name='customer_email']"), true, 'Địa chỉ e-mail không đúng. Xin vui lòng kiểm tra.');
    _custom_scroll_to(container, jQuery("input[name='customer_email']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='customer_email']"), false, 'QUAN TRỌNG: Địa chỉ e-mail đúng để nhận tin xác thực giao dịch.');
  }

  jQuery("#edit-pgpb-body div.views-row").each(function() {
    var uid = jQuery(this).find('span.list-pg').attr('uid');
    if (uid != undefined && parseInt(uid) > 0) {
      pg_list.push(uid);
    }
  });
  
  if (!pg_list.length) {
    jQuery("#edit-pgpb").addClass('error');
    _custom_scroll_to(container, jQuery("#edit-pgpb"));
    return false;
  }
  else{  
    // Remove PG who not providing the selected service.
    var pg_list_new = new Array();
    for (var i = 0; i < pg_list.length; i++) {
      if (Drupal.settings['pg_services'][pg_list[i]][appointment_service] != undefined) {
        pg_list_new.push(pg_list[i]);
      }
    }
    
    pg_list = pg_list_new;
    
    if (!pg_list.length) {
      //jQuery("#edit-appointment-service").addClass('error');
      _custom_form_set_error(jQuery("#edit-appointment-service"), true, 'Thành viên được bạn chọn hiện không cung cấp dịch vụ <b>' + Drupal.settings['default_pricing'][appointment_service]['name'] + '</b>. Vui lòng chọn dịch vụ hoặc thành viên khác để đặt.');
      _custom_scroll_to(container, jQuery("#edit-appointment-service"));
      return false;
    }
  }
  
  if (pg_list.length > 5) {
    jQuery("#edit-pgpb").addClass('error');
    _custom_scroll_to(container, jQuery("#edit-pgpb"), function() {
      var person_left = pg_list.length - 5;
      custom_dialog_alert('Thông báo', 'Bạn đã chọn quá 5 người để gửi yêu cầu đặt lịch. Vui lòng bỏ bớt ' + person_left + ' người rồi tiếp tục.');
    });

    return false;
  }
  else{
    jQuery("#edit-pgpb").removeClass('error');
  }

  if (appointment_service == undefined || isNaN(appointment_service) || !appointment_service) {
    _custom_form_set_error(jQuery("#edit-appointment-service"), true, 'Vui lòng chọn dịch vụ bạn muốn đặt thuê.');
    _custom_scroll_to(container, jQuery("#edit-appointment-service"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("#edit-appointment-service"), false, '');
  }

  if (appointment_datetime == '') {
    _custom_form_set_error(jQuery("input[name='appointment_datetime']"), true, 'Vui lòng chọn thời gian bắt đầu thuê dịch vụ.');
    _custom_scroll_to(container, jQuery("input[name='appointment_datetime']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='appointment_datetime']"), false, '');
  }

  if (appointment_duration == '') {
    _custom_form_set_error(jQuery("input[name='appointment_duration']"), true, 'Vui lòng chọn số giờ / ngày thuê dịch vụ.');
    _custom_scroll_to(container, jQuery("input[name='appointment_duration']"));
    return false;
  }
  else{
    appointment_duration = parseInt(appointment_duration);

    // Check for minimum requirement.
    var condition_unit_minimum = 100;
    var unit = {
      'hour': 'giờ',
      'day': 'ngày'
    };
    
    for (var uid in Drupal.settings['pg_services']) {
      if (Drupal.settings['pg_services'][uid][appointment_service] != undefined) {
        var condition_unit = parseInt(Drupal.settings['pg_services'][uid][appointment_service]['condition_unit']);
        if (condition_unit_minimum > condition_unit) {
          condition_unit_minimum = condition_unit;
        }
      }
    }
    
    if (appointment_duration < condition_unit_minimum) {
      _custom_form_set_error(jQuery("input[name='appointment_duration']"), true, 'Vui lòng chọn thời gian tối thiểu là <b>' + condition_unit_minimum + ' ' + unit[Drupal.settings['default_pricing'][appointment_service]['unit']] + '</b> thuê.');
      _custom_scroll_to(container, jQuery("input[name='appointment_duration']"));
      return false;
    }
    
    // Filter to get PG those meet the minimum time.
    var pg_list_new = new Array();
    for (var i = 0; i < pg_list.length; i++) {
      if (Drupal.settings['pg_services'][pg_list[i]][appointment_service] != undefined) {
        var condition_unit = parseInt(Drupal.settings['pg_services'][pg_list[i]][appointment_service]['condition_unit']);

        if (condition_unit <= appointment_duration) {
          pg_list_new.push(pg_list[i]);
        }
      }
    }
    
    pg_list = pg_list_new;

    _custom_form_set_error(jQuery("input[name='appointment_duration']"), false, 'Thời gian thuê dịch vụ tính từ thời điểm bắt đầu.');
  }

  if (appointment_city == '') {
    _custom_form_set_error(jQuery("#edit_appointment_city_chosen"), true, 'Vui lòng chọn Thành phố / Tỉnh thành nơi thuê dịch vụ.');
    _custom_scroll_to(container, jQuery("#edit_appointment_city_chosen"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("#edit_appointment_city_chosen"), false, '');
  }

  if (appointment_address == '') {
    _custom_form_set_error(jQuery("input[name='appointment_address']"), true, 'Vui lòng chọn địa điểm, nơi hẹn gặp.');
    _custom_scroll_to(container, jQuery("input[name='appointment_address']"));
    return false;
  }
  else{
    _custom_form_set_error(jQuery("input[name='appointment_address']"), false, 'Địa chỉ số nhà, tên đường phố, nơi hẹn gặp.');
  }
  
  if (jQuery("input[name='captcha_response']").length && captcha == '') {
    _custom_form_set_error(jQuery("input[name='captcha_response']"), true, 'Vui lòng nhập mã an ninh để tiếp tục. Ví dụ: cho 1+3, hãy nhập 4.');
    _custom_scroll_to(container, jQuery("input[name='captcha_response']"));
    return false;    
  }
  else{
    _custom_form_set_error(jQuery("input[name='captcha_response']"), false, 'Tính các phép tính đơn giản này và nhập kết quả vào. Ví dụ: cho 1+3, hãy nhập 4.');
  }
  
  // Create values to send to server.
  var params = {
    receivers: pg_list,
    customer_name: customer_name,
    customer_gender: customer_gender,
    customer_age: customer_age,
    customer_mobile: customer_mobile,
    customer_email: customer_email,
    appointment_service: appointment_service,
    appointment_datetime: appointment_datetime,
    appointment_duration: appointment_duration,
    appointment_city: appointment_city,
    appointment_address: appointment_address
  };
  
  //console.log(params);
  //return false;

  // Add disable to avoid duplicated clicks.
  jQuery(obj).attr('disabled', true);  
  var loading_message = _custom_dialog_ajax_loading();
  
  //console.log(params);  
  custom_services_request('appointments_create', {params: params}, function(result) {
    //console.log(result);
    
    jQuery(obj).attr('disabled', false);
    loading_message.dialog('close');
    
    if (result['is_error']) {
      custom_dialog_alert('Thông báo', result['message']);
      return false;
    }
    
    // Go to complete page.
    var nids = new Array();
    for (var i = 0; i < result['appointment_nids'].length; i++) {
      nids.push('nids[' + i + ']=' + result['appointment_nids'][i]);
    }
    
    document.location.href = '/lien-he-thue-nguoi-yeu-da-dang-ky?' + nids.join('&');
  });
  
  return false;
}

/**
 * Helper function to output error message to field.
 */
function _custom_form_set_error(obj, is_error, message) {
  if (!is_error) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html(message);
    }
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');
    
    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html(message);
  }
}

/**
 * Scroll to an element.
 */
function _custom_scroll_to(container, element, callback) {
  var top = element.offset().top - container.offset().top + container.scrollTop();
  
  if (typeof callback == 'function') {
    jQuery('html,body').animate({scrollTop: top}, function() {
      callback();
    });
  }
  else{
    jQuery('html,body').animate({scrollTop: top});
  }
}

/**
 * Process on the click event for apppointment services.
 */
function custom_trigger_appointment_service_callback(obj) {
  if (jQuery(obj).parent().children('span.desc').hasClass('checked')) {return false;}
  
  // Remove other active class.
  jQuery("#edit-appointment-service span.label.checked").removeClass('checked');
  jQuery("#edit-appointment-service span.desc.checked").removeClass('checked');
  
  // Add active to current.
  jQuery(obj).parent().children('span.label').addClass('checked');
  jQuery(obj).parent().children('span.desc').addClass('checked');

  _custom_form_set_error(jQuery("#edit-appointment-service"), false, '');
  
  // Change unit of time.
  var tid = jQuery(obj).val();
  if (Drupal.settings['default_pricing'] && Drupal.settings['default_pricing'][tid]) {
    if (Drupal.settings['default_pricing'][tid]['unit'] == 'day') {
      jQuery("#edit-appointment-duration").parent().find('label').html('Số ngày <span class="form-required" title="Trường dữ liệu này là bắt buộc.">*</span>');
    }
    else{
      jQuery("#edit-appointment-duration").parent().find('label').html('Số giờ <span class="form-required" title="Trường dữ liệu này là bắt buộc.">*</span>');
    }
  }
  
  // Update unit.
  var unit = {
    'hour': 'giờ',
    'day': 'ngày'
  };

  if (!jQuery("input[name='appointment_duration']").parent().find('#appointment-duration-update').length) {
    jQuery("input[name='appointment_duration']").parent().append('<div id="appointment-duration-update"></div>');
  }
  
  jQuery("#appointment-duration-update").html('');
  
  var condition_unit_minimum = 100;
  for (var uid in Drupal.settings['pg_services']) {
    if (Drupal.settings['pg_services'][uid][tid] != undefined) {
      jQuery("#appointment-duration-update").append('<p class="pg-validate-warning warning" uid="' + uid + '"><b>' + Drupal.settings['pg_services'][uid]['pg_name'] + '</b> yêu cầu tối thiểu ' + Drupal.settings['pg_services'][uid][tid]['condition_unit'] + ' ' + unit[Drupal.settings['pg_services'][uid][tid]['unit']] + ' thuê.</p>');
      
      var condition_unit = parseInt(Drupal.settings['pg_services'][uid][tid]['condition_unit']);
      if (condition_unit_minimum > condition_unit) {
        condition_unit_minimum = condition_unit;
      }
    }
  }
  
  // Update default minimum value for Time field.
  if (condition_unit_minimum != 100) {
    jQuery("input[name='appointment_duration']").val(condition_unit_minimum);
    _custom_form_set_error(jQuery("input[name='appointment_duration']"), false, 'Thời gian thuê dịch vụ tính từ thời điểm bắt đầu.');
  }
  
  // Remove if empty.
  if (!jQuery("#appointment-duration-update").children('p.pg-validate-warning').length) {
    jQuery("#appointment-duration-update").remove();
    
    // Give error message being no PG services.
    custom_dialog_alert('Thông báo', 'Thành viên được bạn chọn hiện không cung cấp dịch vụ <b>' + Drupal.settings['default_pricing'][tid]['name'] + '</b>. Vui lòng chọn dịch vụ hoặc thành viên khác để đặt.');
  }
}

/**
 * Process to validate user city.
 */
function custom_validate_user_city_callback(obj) {
  var city_tid = jQuery(obj).val();
  if (city_tid != '' && city_tid > 0) {
    jQuery("#edit_field_cities_und_chosen").removeClass('error');
    jQuery("#edit_field_cities_und_chosen").closest('.form-item').removeClass('error');
    
    if (jQuery("#edit_field_cities_und_chosen").next().length) {
      jQuery("#edit_field_cities_und_chosen").next().removeClass('error').html('');
    }
    
    return true;
  }
  else{
    jQuery("#edit_field_cities_und_chosen").closest('.form-item').addClass('error');
    jQuery("#edit_field_cities_und_chosen").addClass('error');

    if (!jQuery("#edit_field_cities_und_chosen").next().length) {
      jQuery("#edit_field_cities_und_chosen").after('<div class="help-block"></div>');
    }

    jQuery("#edit_field_cities_und_chosen").next().addClass('error').html('Vui lòng chọn Tỉnh / Thành phố nơi bạn đang cư trú.');
    
    return false;
  }
}

/**
 * Proces to validate birthday field.
 */
function custom_validate_user_birthdate_callback(obj) {
  var current_date = new Date();
  var params = jQuery(obj).val().trim().split(/\//);
  
  if (params[0] == '' || !parseInt(params[0]) || parseInt(params[0]) > 31 || !parseInt(params[1]) || parseInt(params[1]) > 12 || parseInt(params[2]) < current_date.getFullYear() - 60 || parseInt(params[2]) > current_date.getFullYear() - 14) {
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng chọn Ngày sinh của bạn.');
    
    return false;
  }
  else{
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('E.g., ' + current_date.getDate() + '/' + current_date.getMonth() + '/' + current_date.getFullYear());
    }
    
    return true;
  }
}

/**
 * Validate for user pass field.
 * Only remove the error if validaed, otherwise leave it for Drupal core js.
 */
function custom_validate_user_pass_callback(obj) {
  var pass = jQuery("#edit-pass-pass1").val().trim();
  var pass_confirm = jQuery("#edit-pass-pass2").val().trim();

  if (pass == '' || pass != pass_confirm) {
    /*
    jQuery("#edit-pass-pass1").parent().addClass('has-error');
    jQuery("#edit-pass-pass2").parent().addClass('has-error');
    jQuery("div.form-type-password-confirm > div.help-block").addClass('error').html('Mật khẩu chưa nhập hoặc không trùng với Mật khẩu xác nhận. Vui lòng kiểm tra rồi thử lại.');
    */
  }
  else{
    jQuery("#edit-pass-pass1").parent().removeClass('has-error');
    jQuery("#edit-pass-pass2").parent().removeClass('has-error');
    jQuery("div.form-type-password-confirm > div.help-block").removeClass('error').html('Nhập cùng một mật khẩu cho tài khoản mới vào cả 2 trường.');
  }
}

/**
 * Validate for gender field.
 */
function custom_validate_user_gender_callback(obj) {
  jQuery("#edit-field-gender-und").children().removeClass('has-error');
}

/**
 * Proces to validate height field.
 */
function custom_validate_user_height_callback(obj) {
  var height = parseInt(jQuery(obj).val().trim());
  if (height >= 140 && height <= 250) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('Ghi theo dạng chữ số: Ví dụ: 163 (= 1m63)');
    }
    
    return true;
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng nhập Chiều cao đúng của bạn. Ví dụ: 1m63 bạn nhập 163');
    
    return false;
  }
}

/**
 * Proces to validate weight field.
 */
function custom_validate_user_weight_callback(obj) {
  var weight = parseInt(jQuery(obj).val().trim());
  if (weight >= 40 && weight <= 150) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('Ghi theo số đã làm tròn theo kg. Ví dụ: 54 (54kg)');
    }
    
    return true;
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng nhập Cân nặng đúng của bạn. Ví dụ: 54kg bạn nhập 54');
    
    return false;
  }
}

/**
 * Process to validate a full name field.
 */
function custom_validate_user_full_name_callback(obj) {
  var name = jQuery(obj).val().trim();
  if (name != '') {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('Tên đầy đủ của bạn, viết hoa chữ cái đầu, ví dụ: Trần Thu Thảo');
    }
    
    return true;
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng nhập Họ và tên của bạn để tiện liên hệ.');
    
    return false;
  }
}

/**
 * Process to validate a full name field.
 */
function custom_validate_user_agreement_callback(obj) {
  var is_checked = jQuery(obj).prop('checked');
  
  if (is_checked) {
    jQuery("#edit-field-agreement-und").closest('.form-item').removeClass('has-error');
    return true;
  }
  else{
    jQuery("#edit-field-agreement-und").closest('.form-item').addClass('has-error');
    return false;
  }
}

/**
 * Process to validate customer name.
 */
function custom_validate_customer_name_callback(obj) {
  var customer_name = jQuery(obj).val().trim();
  if (customer_name != '') {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('Vui lòng nhập tên của bạn để tiện liên hệ.');
    }
    
    if (customer_default == null) {
      customer_default = {};
    }
    
    customer_default['customer_name'] = customer_name;
    custom_variable_set('customer_default', JSON.stringify(customer_default));
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng nhập tên của bạn để tiện liên hệ.');
  }
}

/**
 * Process to validate customer gender.
 */
function custom_validate_customer_gender_callback(obj) {
  if (customer_default == null) {
    customer_default = {};
  }
    
  customer_default['customer_gender'] = jQuery(obj).val();
  custom_variable_set('customer_default', JSON.stringify(customer_default));

  _custom_form_set_error(jQuery("#edit-customer-gender"), false, '');
}

/**
 * Process to validate appointment datetime.
 */
function custom_validate_appointment_datetime_callback(obj) {
  var appointment_datetime = jQuery(obj).val().trim();
  if (appointment_datetime != '') {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('');
    }
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng chọn thời gian bắt đầu thuê dịch vụ.');
  } 
}

/**
 * Process to validate appointment duration.
 */
function custom_validate_appointment_duration_callback(obj) {
  var appointment_duration = parseInt(jQuery(obj).val().trim());

  if (!isNaN(appointment_duration) && appointment_duration > 0) {
    // Check for minimum requirement.
    var tid = jQuery("input[name='appointment_service']:checked").val();
    var condition_unit_minimum = 24; // 24h.
    var unit = {
      'hour': 'giờ',
      'day': 'ngày'
    };
    
    for (var uid in Drupal.settings['pg_services']) {
      if (Drupal.settings['pg_services'][uid][tid] != undefined) {
        var condition_unit = parseInt(Drupal.settings['pg_services'][uid][tid]['condition_unit']);
        if (condition_unit_minimum > condition_unit) {
          condition_unit_minimum = condition_unit;
        }
      }
    }
    
    if (appointment_duration < condition_unit_minimum) {
      jQuery(obj).closest('.form-item').addClass('error');
      jQuery(obj).addClass('error');

      if (!jQuery(obj).next().length) {
        jQuery(obj).after('<div class="help-block"></div>');
      }

      jQuery(obj).next().addClass('error').html('Vui lòng chọn thời gian tối thiểu là <b>' + condition_unit_minimum + ' ' + unit[Drupal.settings['default_pricing'][tid]['unit']] + '</b> thuê.');      
    }
    else{
      jQuery(obj).removeClass('error');
      jQuery(obj).closest('.form-item').removeClass('error');
    
      if (jQuery(obj).next().length) {
        jQuery(obj).next().removeClass('error').html('Thời gian thuê dịch vụ tính từ thời điểm bắt đầu.');
      }
    
      jQuery(obj).val(appointment_duration);      
    }
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng chọn số giờ / ngày thuê dịch vụ.');
  } 
}

/**
 * Process to validate appointment city.
 */
function custom_validate_appointment_city_callback(obj) {
  var appointment_city = jQuery(obj).val();
  if (appointment_city != '' && appointment_city > 0) {
    jQuery("#edit_appointment_city_chosen").removeClass('error');
    jQuery("#edit_appointment_city_chosen").closest('.form-item').removeClass('error');
    
    if (jQuery("#edit_appointment_city_chosen").next().length) {
      jQuery("#edit_appointment_city_chosen").next().removeClass('error').html('');
    }
  }
  else{
    jQuery("#edit_appointment_city_chosen").closest('.form-item').addClass('error');
    jQuery("#edit_appointment_city_chosen").addClass('error');

    if (!jQuery("#edit_appointment_city_chosen").next().length) {
      jQuery("#edit_appointment_city_chosen").after('<div class="help-block"></div>');
    }

    jQuery("#edit_appointment_city_chosen").next().addClass('error').html('Vui lòng chọn Thành phố / Tỉnh thành nơi thuê dịch vụ.');
  }
}

/**
 * Process to validate appointment address.
 */
function custom_validate_appointment_address_callback(obj) {
  var appointment_address = jQuery(obj).val().trim();
  if (appointment_address != '') {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    
    if (jQuery(obj).next().length) {
      jQuery(obj).next().removeClass('error').html('Địa chỉ số nhà, tên đường phố, nơi hẹn gặp.');
    }
    
    jQuery(obj).val(appointment_address);
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');

    if (!jQuery(obj).next().length) {
      jQuery(obj).after('<div class="help-block"></div>');
    }

    jQuery(obj).next().addClass('error').html('Vui lòng chọn địa điểm, nơi hẹn gặp.');
  }
}

/**
 * Process to validate age.
 */
function custom_validate_customer_age_callback(obj) {
  var age = parseInt(jQuery(obj).val().trim().replace(/\s+/g, ''));
  if (age >= 18 && age <= 65) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    jQuery(obj).next().removeClass('error').html('Nhập tuổi của bạn để PG/PB tiếp đón phù hợp. Bạn phải từ 18 tuổi trở lên để có thể sử dụng dịch vụ.');
    
    jQuery(obj).val(age);

    if (customer_default == null) {
      customer_default = {};
    }
    
    customer_default['customer_age'] = age;
    custom_variable_set('customer_default', JSON.stringify(customer_default));
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');
    jQuery(obj).next().addClass('error').html('Số tuổi của bạn không phù hợp. Xin vui lòng kiểm tra.');
  }
}

/**
 * Process to validate email.
 */
function custom_validate_is_email_callback(obj) {
  var email = jQuery(obj).val().trim().replace(/\s+/g, '');
  if (custom_validate_is_email(email)) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    jQuery(obj).next().removeClass('error').html('QUAN TRỌNG: Địa chỉ e-mail đúng để nhận tin xác thực giao dịch.');
    
    jQuery(obj).val(email);

    if (customer_default == null) {
      customer_default = {};
    }
    
    customer_default['customer_email'] = email;
    custom_variable_set('customer_default', JSON.stringify(customer_default));

    return true;
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');
    jQuery(obj).next().addClass('error').html('Địa chỉ e-mail không đúng. Xin vui lòng kiểm tra.');
    
    return false;
  }
}

/**
 * Process to validate mobile number.
 */
function custom_validate_is_mobile_number_callback(obj) {
  var number = jQuery(obj).val().trim().replace(/\s+/g, '');
  if (custom_validate_is_mobile_number(number)) {
    jQuery(obj).removeClass('error');
    jQuery(obj).closest('.form-item').removeClass('error');
    jQuery(obj).next().removeClass('error').html('QUAN TRỌNG: Số di động đúng để nhận tin xác thực giao dịch.');
    
    jQuery(obj).val(number);

    if (customer_default == null) {
      customer_default = {};
    }
    
    customer_default['customer_mobile'] = number;
    custom_variable_set('customer_default', JSON.stringify(customer_default));

    return true;
  }
  else{
    jQuery(obj).closest('.form-item').addClass('error');
    jQuery(obj).addClass('error');
    jQuery(obj).next().addClass('error').html('Số điện thoại không đúng. Xin vui lòng kiểm tra.');
    
    return false;
  }
}

/**
 * Switch state of service on popup.
 */
function giaidieu_service_price_status(state) {
  if (state == 1) {
    jQuery("#custom-service-price-form-wrapper #service-status").removeClass('service-status-disabled');
    jQuery("#custom-service-price-form-wrapper #service-status").addClass('service-status-enabled');
  }
  else{
    jQuery("#custom-service-price-form-wrapper #service-status").removeClass('service-status-enabled');
    jQuery("#custom-service-price-form-wrapper #service-status").addClass('service-status-disabled');
  }
}

/**
 * Wrapper function to load an ajax message.
 */
function _custom_dialog_ajax_loading() {
  return custom_dialog_ajax_loading('Đang xử lý...', 'Xin vui lòng chờ trong giây lát!');
}

/**
 * Show a popup for PG to setup custom pricing.
 */
function giaidieu_pg_set_custom_pricing(obj) {
  if (jQuery(obj).hasClass('disabled')) {return false;}
  
  var nid = parseInt(jQuery(obj).attr('nid'));
  var tid = parseInt(jQuery(obj).attr('tid'));
  if (isNaN(nid) || !nid || isNaN(tid) || !tid) {
    alert('Không tìm thấy dữ liệu. Vui lòng tải lại trang rồi thử lại.');
    return false;
  }
  
  // Get the form.
  jQuery(obj).addClass('disabled');
  var loading_message = _custom_dialog_ajax_loading();
  
  custom_services_request('custom_service_price_form', {nid: nid}, function(result) {
    jQuery(obj).removeClass('disabled');
    loading_message.dialog('close');
    
    if (result['is_error']) {
      alert(result['message']);
      return false;
    }

    // Show popup.
    custom_dialog_confirm('Điều chỉnh thông tin dịch vụ', result['form'], 600, 'auto', true, function() {
      // Collect value for updating.
      var status = jQuery("#custom-service-price-form-wrapper input[name='status']:checked").val();
      var unit = jQuery("#custom-service-price-form-wrapper select[name='unit']").val();
      var condition_unit = jQuery("#custom-service-price-form-wrapper select[name='condition_unit']").val();
      var condition_time = jQuery("#custom-service-price-form-wrapper select[name='condition_time']").val();
      
      var service_price = parseInt(jQuery("#custom-service-price-form-wrapper input[name='service_price']").val().trim().replace(/\,/g, ''));
      var add_on_1 = parseInt(jQuery("#custom-service-price-form-wrapper input[name='add_on_1']").val().trim().replace(/\,/g, ''));
      var add_on_2 = parseInt(jQuery("#custom-service-price-form-wrapper input[name='add_on_2']").val().trim().replace(/\,/g, ''));
      var add_on_3 = parseInt(jQuery("#custom-service-price-form-wrapper input[name='add_on_3']").val().trim().replace(/\,/g, ''));
      var add_on_4 = parseInt(jQuery("#custom-service-price-form-wrapper input[name='add_on_4']").val().trim().replace(/\,/g, ''));
      
      if (isNaN(service_price) || service_price < Drupal.settings['default_pricing'][tid]['price']) {
        jQuery("#custom-service-price-form-wrapper input[name='service_price']").addClass('error');
        custom_dialog_alert('Thông báo', 'Vui lòng nhập mức Phí dịch vụ hợp lệ và không thấp hơn mức sàn quy định là ' + custom_thousand_format(Drupal.settings['default_pricing'][tid]['price']) + 'đ');
        return false;
      }
      else{
        jQuery("#custom-service-price-form-wrapper input[name='service_price']").removeClass('error');
      }

      if (isNaN(add_on_1) || add_on_1 < Drupal.settings['default_pricing'][tid]['price_add_on_1']) {
        jQuery("#custom-service-price-form-wrapper input[name='add_on_1']").addClass('error');
        custom_dialog_alert('Thông báo', 'Vui lòng nhập mức Phí cộng thêm hợp lệ và không thấp hơn mức sàn quy định là ' + custom_thousand_format(Drupal.settings['default_pricing'][tid]['price_add_on_1']) + 'đ');
        return false;
      }
      else{
        jQuery("#custom-service-price-form-wrapper input[name='add_on_1']").removeClass('error');
      }

      if (isNaN(add_on_2) || add_on_2 < Drupal.settings['default_pricing'][tid]['price_add_on_2']) {
        jQuery("#custom-service-price-form-wrapper input[name='add_on_2']").addClass('error');
        custom_dialog_alert('Thông báo', 'Vui lòng nhập mức Phí cộng thêm hợp lệ và không thấp hơn mức sàn quy định là ' + custom_thousand_format(Drupal.settings['default_pricing'][tid]['price_add_on_2']) + 'đ');
        return false;
      }
      else{
        jQuery("#custom-service-price-form-wrapper input[name='add_on_2']").removeClass('error');
      }

      if (isNaN(add_on_3) || add_on_3 < Drupal.settings['default_pricing'][tid]['price_add_on_3']) {
        jQuery("#custom-service-price-form-wrapper input[name='add_on_3']").addClass('error');
        custom_dialog_alert('Thông báo', 'Vui lòng nhập mức Phí cộng thêm hợp lệ và không thấp hơn mức sàn quy định là ' + custom_thousand_format(Drupal.settings['default_pricing'][tid]['price_add_on_3']) + 'đ');
        return false;
      }
      else{
        jQuery("#custom-service-price-form-wrapper input[name='add_on_3']").removeClass('error');
      }

      if (isNaN(add_on_4) || add_on_4 < Drupal.settings['default_pricing'][tid]['price_add_on_4']) {
        jQuery("#custom-service-price-form-wrapper input[name='add_on_4']").addClass('error');
        custom_dialog_alert('Thông báo', 'Vui lòng nhập mức Phí đặc biệt hợp lệ và không thấp hơn mức sàn quy định là ' + custom_thousand_format(Drupal.settings['default_pricing'][tid]['price_add_on_4']) + '%');
        return false;
      }
      else{
        jQuery("#custom-service-price-form-wrapper input[name='add_on_4']").removeClass('error');
      }
      
      // Check if changed?
      var is_changed = false;
      if (status != Drupal.settings['pg_pricing'][tid]['status'] || unit != Drupal.settings['pg_pricing'][tid]['unit'] || condition_unit != Drupal.settings['pg_pricing'][tid]['condition_unit'] || condition_time != Drupal.settings['pg_pricing'][tid]['condition_time'] || service_price != Drupal.settings['pg_pricing'][tid]['price'] || add_on_1 != Drupal.settings['pg_pricing'][tid]['price_add_on_1'] || add_on_2 != Drupal.settings['pg_pricing'][tid]['price_add_on_2'] || add_on_3 != Drupal.settings['pg_pricing'][tid]['price_add_on_3'] || add_on_4 != Drupal.settings['pg_pricing'][tid]['price_add_on_4']) {
        is_changed = true;
      }
      
      // Update to PG service pricing.
      if (is_changed) {
        var params = {
          nid: nid,
          node_fields: {
            'status': status,
            'field_unit': {'value': unit},
            'field_condition_unit': {'value': condition_unit},
            'field_condition_time': {'value': condition_time},
            'field_service_price': {'value': service_price},
            'field_price_add_on_1': {'value': add_on_1},
            'field_price_add_on_2': {'value': add_on_2},
            'field_price_add_on_3': {'value': add_on_3},
            'field_price_add_on_4': {'value': add_on_4}
          }
        };
        
        var loading_message = _custom_dialog_ajax_loading();
        custom_services_request('node_store', params, function(result) {
          loading_message.dialog('close');
          
          if (result['is_error']) {
            custom_dialog_alert('Thông báo', result['message']);
            return false;
          }
          
          jQuery("#custom-dialog-confirm").dialog("close");
          
          // Page reload. 
          custom_dialog_confirm('Thông báo', 'Thông tin dịch vụ đã được cập nhật thành công!<br />Vui lòng nhấn "Đồng ý" để tải lại trang.', 'auto', 'auto', false, function() {
            document.location.reload();
          });
        });
      }
      else{
        // Close the popup.
        jQuery("#custom-dialog-confirm").dialog("close");
      }
    });
  });
  
  return false;
}

/**
 * Reset the pricing back to default setting.
 */
function giaidieu_pg_set_default_pricing(obj) {
  var nid = parseInt(jQuery(obj).attr('nid'));
  if (isNaN(nid) || !nid) {
    alert('Không tìm thấy dữ liệu. Vui lòng tải lại trang rồi thử lại.');
    return false;
  }

  custom_dialog_confirm('Thiết lập mặc định thông tin dịch vụ', 'Bạn chắc chắn muốn chuyển về thiết lập mặc định cho dịch vụ này?<br />Lưu ý: Thao tác này không thể đảo ngược!', 600, 'auto', true, function() {
    jQuery("#custom-dialog-confirm").dialog("close");

    var loading_message = _custom_dialog_ajax_loading();
    custom_services_request('custom_service_price_reset', {nid: nid}, function(result) {
      loading_message.dialog('close');

      if (result['is_error']) {
        alert(result['message']);
        return false;
      }
          
      jQuery("#custom-dialog-confirm").dialog("close");
          
      // Page reload. 
      custom_dialog_confirm('Thông báo', 'Thông tin dịch vụ đã được chuyển về thiết lập mặc định thành công!<br />Nhấn "Đồng ý" để tải lại trang.', 'auto', 'auto', false, function() {
        document.location.reload();
      });
    });
  });
  
  return false;
}

/**
 * Profile step 1 validation.
 */
function giaidieu_user_profile_section_step_1_validate() {
  var email = jQuery("#edit-mail").val().trim();
  var pass = jQuery("#edit-pass-pass1").val().trim();
  var pass_confirm = jQuery("#edit-pass-pass2").val().trim();

  // Validate for Step 1.
  var is_step_1_validated = true;

  if (!custom_validate_is_email_callback(jQuery("#edit-mail"))) {
    is_step_1_validated = false;
  }

  if (jQuery("#user-profile-form").length) {
    // In edit mode.
    if (pass != '') {
      if (pass != pass_confirm) {
        jQuery("#edit-pass-pass1").parent().addClass('has-error');
        jQuery("#edit-pass-pass2").parent().addClass('has-error');
        jQuery("div.form-type-password-confirm > div.help-block").addClass('error').html('Mật khẩu mới không trùng với Mật khẩu xác nhận. Vui lòng kiểm tra rồi thử lại.');
        is_step_1_validated = false;
      }
      else if (jQuery("#edit-current-pass").val().trim() == '') {
        jQuery("#edit-current-pass").parent().addClass('has-error');
        jQuery("div.form-type-password-confirm > div.help-block").addClass('error').html('Bạn chưa nhập Mật khẩu hiện tại để đổi Mật khẩu mới. Vui lòng kiểm tra rồi thử lại.');
        is_step_1_validated = false;
      }
      else{
        jQuery("#edit-pass-pass1").parent().removeClass('has-error');
        jQuery("#edit-pass-pass2").parent().removeClass('has-error');
        jQuery("#edit-current-pass").parent().removeClass('has-error');
        jQuery("div.form-type-password-confirm > div.help-block").removeClass('error').html('Để đổi mật khẩu hiện tại, vui lòng nhập mật khẩu mới vào.');        
      }
    }
    else{
      // Reset.
      jQuery("#edit-pass-pass1").val('');
      jQuery("#edit-pass-pass2").val('');
      jQuery("#edit-current-pass").val('');
      
      jQuery("#edit-pass-pass1").parent().removeClass('has-error');
      jQuery("#edit-pass-pass2").parent().removeClass('has-error');
      jQuery("#edit-current-pass").parent().removeClass('has-error');
      jQuery("div.form-type-password-confirm > div.help-block").removeClass('error').html('Để đổi mật khẩu hiện tại, vui lòng nhập mật khẩu mới vào.');        
    }
  }
  else{
    // In register mode.
    if (pass == '' || pass != pass_confirm) {
      jQuery("#edit-pass-pass1").parent().addClass('has-error');
      jQuery("#edit-pass-pass2").parent().addClass('has-error');
      jQuery("div.form-type-password-confirm > div.help-block").addClass('error').html('Mật khẩu chưa nhập hoặc không trùng với Mật khẩu xác nhận. Vui lòng kiểm tra rồi thử lại.');
    
      is_step_1_validated = false;
    }
    else{
      jQuery("#edit-pass-pass1").parent().removeClass('has-error');
      jQuery("#edit-pass-pass2").parent().removeClass('has-error');
      jQuery("div.form-type-password-confirm > div.help-block").removeClass('error').html('Nhập cùng một mật khẩu cho tài khoản mới vào cả 2 trường.');
    }
  }
  
  if (!is_step_1_validated) {
    giaidieu_user_profile_section('group-account', true);
    custom_dialog_alert('Thông báo', 'Bạn chưa hoàn thành nhập thông tin cho mục "TÀI KHOẢN". Xin vui lòng kiểm tra những trường có màu đỏ rồi thử lại.');
    return false;
  }
  
  return true;
}

/**
 * Profile step 2 validation.
 */
function giaidieu_user_profile_section_step_2_validate() {
  // Validate for Step 2.
  var nyd_role = Drupal.settings['nyd_role'];
  var gender = jQuery("#edit-field-gender-und input[type='radio']:checked").attr('value');
  var is_step_2_validated = true;
  
  if (!custom_validate_user_full_name_callback(jQuery("#edit-field-full-name-und-0-value"))) {
    is_step_2_validated = false;
  }
      
  if (gender != 0 && gender != 1) {
    jQuery("#edit-field-gender-und input[type='radio']").closest('.form-item').addClass('has-error');
    is_step_2_validated = false;
  }
  else{
    jQuery("#edit-field-gender-und input[type='radio']").closest('.form-item').removeClass('has-error');
  }
  
  //console.log(nyd_role);
  
  if (nyd_role == 'pg') {
    if (!custom_validate_user_birthdate_callback(jQuery("#edit-field-birthdate-und-0-value-datepicker-popup-0"))) {
      is_step_2_validated = false;
    }

    if (!custom_validate_user_height_callback(jQuery("#edit-field-height-und-0-value"))) {
      is_step_2_validated = false;
    }

    if (!custom_validate_user_weight_callback(jQuery("#edit-field-weight-und-0-value"))) {
      is_step_2_validated = false;
    }
  }
  
  if (!is_step_2_validated) {
    giaidieu_user_profile_section('group-basic', true);
    custom_dialog_alert('Thông báo', 'Bạn chưa hoàn thành nhập thông tin cho mục "CÁ NHÂN". Xin vui lòng kiểm tra những trường có màu đỏ rồi thử lại.');
    return false;
  }
  
  return true;
}

/**
 * Profile step 3 validation.
 */
function giaidieu_user_profile_section_step_3_validate() {
  var nyd_role = Drupal.settings['nyd_role'];
  if (nyd_role != 'pg') {return true;}
  
  if (jQuery("input[name='photo_avatar']").val().trim() == '') {
    jQuery("#photo-avatar").addClass('has-error');
    giaidieu_user_profile_section('group-photos', true);
    
    custom_dialog_alert('Thông báo', 'Bạn chưa hoàn thành nhập thông tin cho mục "HÌNH ẢNH". Vui lòng tải lên hoặc chọn từ Facebook của bạn ít nhất một ảnh để làm hình đại diện.');
    return false;
  }
  else{
    jQuery("#photo-avatar").removeClass('has-error');
  }
  
  return true;
}

/**
 * Profile step 4 validation.
 */
function giaidieu_user_profile_section_step_4_validate() {
  var is_step_4_validated = true;
  if (!custom_validate_user_city_callback(jQuery("#edit-field-cities-und"))) {
    is_step_4_validated = false;
  }
  
  if (!custom_validate_is_mobile_number_callback(jQuery("#edit-field-mobile-number-und-0-value"))) {
    is_step_4_validated = false;
  }
  
  if (!is_step_4_validated) {
    giaidieu_user_profile_section('group-contact', true);
    custom_dialog_alert('Thông báo', 'Bạn chưa hoàn thành nhập thông tin cho mục "LIÊN LẠC". Xin vui lòng kiểm tra những trường có màu đỏ rồi thử lại.');
    return false;
  }
  
  return true;
}

/**
 * Profile step 4 validation.
 */
function giaidieu_user_profile_section_step_5_validate() {
  if (!custom_validate_user_agreement_callback(jQuery("#edit-field-agreement-und"))) {
    giaidieu_user_profile_section('group-other', true);
    custom_dialog_alert('Thông báo', 'Bạn chưa hoàn thành nhập thông tin cho mục "THÔNG TIN KHÁC". Xin vui lòng kiểm tra những trường có màu đỏ rồi thử lại.');
    return false;
  }
  
  return true;
}

/**
 * Handle the user profile submit section.
 */
function giaidieu_user_profile_section_submit(obj) {
  // Return if disabled.
  if (jQuery(obj).hasClass('disabled')) {
    return false;
  }
  
  // Do a full validation here - all steps.

  // Validate for Step 1.
  if (!giaidieu_user_profile_section_step_1_validate()) {return false;}
  
  // Validate for Step 2.
  if (!giaidieu_user_profile_section_step_2_validate()) {return false;}

  // Validate for Step 3.
  if (!giaidieu_user_profile_section_step_3_validate()) {return false;}

  // Validate for Step 4.
  if (!giaidieu_user_profile_section_step_4_validate()) {return false;}
  
  // Validate for Step 5.
  if (!giaidieu_user_profile_section_step_5_validate()) {return false;}
  
  // Step 6 - Check for email and mobile existance - Async check.
  var email = jQuery("#edit-mail").val();
  var mobile = jQuery("#edit-field-mobile-number-und-0-value").val();

  if (jQuery("#user-register-form").length) {
    jQuery(obj).addClass('disabled');
    var loading_message = _custom_dialog_ajax_loading();
  
    custom_services_request('account_exists', {email: email, mobile: mobile}, function(result) {
      jQuery(obj).removeClass('disabled');
      loading_message.dialog('close');
    
      if (result['is_error']) {
        // Open the section.
        if (result['type'] == 'email') {
          jQuery("#edit-mail").closest('.form-item').addClass('error');
          jQuery("#edit-mail").addClass('error');
          jQuery("#edit-mail").next().addClass('error').html(result['message']);

          giaidieu_user_profile_section('group-account', true);
        }
        else if (result['type'] == 'mobile') {
          jQuery("#edit-field-mobile-number-und-0-value").closest('.form-item').addClass('error');
          jQuery("#edit-field-mobile-number-und-0-value").addClass('error');
          jQuery("#edit-field-mobile-number-und-0-value").next().addClass('error').html(result['message']);

          giaidieu_user_profile_section('group-contact', true);
        }
      
        // Display error.
        custom_dialog_alert('Thông báo', result['message']);
        return false;
      }
    
      // Submit the form.
      jQuery("#block-system-main form").submit();
    });
  }
  else{
    // Validate email and mobile if changed.
    var current_email = jQuery('input[name="current_email"]').val();
    var current_mobile = jQuery('input[name="current_mobile"]').val();
    
    if (email != current_email) {
      var loading_message = _custom_dialog_ajax_loading();
      custom_services_request('email_exists', {email: email}, function(result) {
        loading_message.dialog('close');
        
        if (result['is_error']) {
          custom_dialog_alert('Thông báo', result['message']);
        }
        else{
          // Check for mobile after email.
          if (mobile != current_mobile) {
            var loading_message2 = _custom_dialog_ajax_loading();
            custom_services_request('mobile_exists', {mobile: mobile}, function(result) {
              loading_message2.dialog('close');
              
              if (result['is_error']) {
                custom_dialog_alert('Thông báo', result['message']);
              }
              else{
                // Submit the form.
                jQuery("#block-system-main form").submit();
              }
            });
          }
          else{
            jQuery("#block-system-main form").submit();
          }
        }
      });
    }
    else if (mobile != current_mobile) {
      var loading_message = _custom_dialog_ajax_loading();
      custom_services_request('mobile_exists', {mobile: mobile}, function(result) {
        loading_message.dialog('close');
              
        if (result['is_error']) {
          custom_dialog_alert('Thông báo', result['message']);
        }
        else{
          // Submit the form.
          jQuery("#block-system-main form").submit();
        }
      });
    }
    else{
      // Submit the form.
      jQuery("#block-system-main form").submit();
    }
  }
}

/**
 * Handle the user profile next section.
 */
function giaidieu_user_profile_section_next(obj) {
  // Return if disabled.
  if (jQuery(obj).hasClass('disabled')) {
    return false;
  }
  
  // Get section id.
  var next_section = jQuery("#user-profile-tabs li.active").next();
  if (next_section == undefined) {return false;}
  
  if (giaidieu_user_profile_section(next_section.attr('rel'))) {
    // Enable prev button.
    jQuery("#link-button-prev").removeClass('disabled');
  }
}

/**
 * Handle the user profile prev section.
 */
function giaidieu_user_profile_section_prev(obj) {
  // Return if disabled.
  if (jQuery(obj).hasClass('disabled')) {
    return false;
  }

  // Get section id.
  var prev_section = jQuery("#user-profile-tabs li.active").prev();
  if (prev_section == undefined) {return false;}
  
  if (giaidieu_user_profile_section(prev_section.attr('rel'))) {
    // Enable next button.
    jQuery("#link-button-next").removeClass('disabled');
  }
}

/**
 * Handle the collapsible on user profile form.
 */
function giaidieu_user_profile_section(section_id, is_validated) {
  if (jQuery("#user-profile-tabs li[rel='" + section_id + "']").hasClass('active')) {
    return false;
  }
  
  if (is_validated == undefined) {
    is_validated = false;
  }
  
  // When moving between steps, validate all the field.
  // Get the current step.
  if (!is_validated) {
    var current_step = parseInt(jQuery("#user-profile-tabs li.active span.step-number").html());
    switch (current_step) {
      case 1:
        if (!giaidieu_user_profile_section_step_1_validate()) {return false;}
        break;

      case 2:
        if (!giaidieu_user_profile_section_step_2_validate()) {return false;}
        break;

      case 3:
        if (!giaidieu_user_profile_section_step_3_validate()) {return false;}
        break;

      case 4:
        if (!giaidieu_user_profile_section_step_4_validate()) {return false;}
        break;

      case 5:
        if (!giaidieu_user_profile_section_step_5_validate()) {return false;}
        break;
    }
  }
  
  // Hide current active.
  if (jQuery("#user-register-form").length) {
    jQuery("#user-register-form fieldset.panel").removeClass('active');
  }
  else if (jQuery("#user-profile-form").length) {
    jQuery("#user-profile-form fieldset.panel").removeClass('active');
  }
  
  jQuery("#user-profile-tabs li").removeClass('active');
  
  // Display new active.
  if (jQuery("#user-register-form").length) {
    jQuery("#user-register-form fieldset#" + section_id).addClass('active');
  }
  else if (jQuery("#user-profile-form").length) {
    jQuery("#user-profile-form fieldset#" + section_id).addClass('active');
  }

  jQuery("#user-profile-tabs li[rel='" + section_id + "']").addClass('active');
  
  // Disable / enable prev / next link.
  if (section_id == 'group-account') {
    jQuery("#link-button-prev").addClass('disabled');
    jQuery("#link-button-next").removeClass('disabled');
  }
  else if (section_id == 'group-other') {
    jQuery("#link-button-prev").removeClass('disabled');
    jQuery("#link-button-next").addClass('disabled');
  }
  else{
    jQuery("#link-button-prev").removeClass('disabled');
    jQuery("#link-button-next").removeClass('disabled');
  }
  
  return false;
};
(function ($) {

  Drupal.behaviors.captcha = {
    attach: function (context) {

      // Turn off autocompletion for the CAPTCHA response field.
      // We do it here with JavaScript (instead of directly in the markup)
      // because this autocomplete attribute is not standard and
      // it would break (X)HTML compliance.
      $("#edit-captcha-response").attr("autocomplete", "off");

    }
  };

  Drupal.behaviors.captchaAdmin = {
    attach: function (context) {
      // Add onclick handler to checkbox for adding a CAPTCHA description
      // so that the textfields for the CAPTCHA description are hidden
      // when no description should be added.
      // @todo: div.form-item-captcha-description depends on theming, maybe
      // it's better to add our own wrapper with id (instead of a class).
      $("#edit-captcha-add-captcha-description").click(function() {
        if ($("#edit-captcha-add-captcha-description").is(":checked")) {
          // Show the CAPTCHA description textfield(s).
          $("div.form-item-captcha-description").show('slow');
        }
        else {
          // Hide the CAPTCHA description textfield(s).
          $("div.form-item-captcha-description").hide('slow');
        }
      });
      // Hide the CAPTCHA description textfields if option is disabled on page load.
      if (!$("#edit-captcha-add-captcha-description").is(":checked")) {
        $("div.form-item-captcha-description").hide();
      }
    }

  };

})(jQuery);
;
(function ($) {

Drupal.googleanalytics = {};

$(document).ready(function() {

  // Attach mousedown, keyup, touchstart events to document only and catch
  // clicks on all elements.
  $(document.body).bind("mousedown keyup touchstart", function(event) {

    // Catch the closest surrounding link of a clicked element.
    $(event.target).closest("a,area").each(function() {

      // Is the clicked URL internal?
      if (Drupal.googleanalytics.isInternal(this.href)) {
        // Skip 'click' tracking, if custom tracking events are bound.
        if ($(this).is('.colorbox') && (Drupal.settings.googleanalytics.trackColorbox)) {
          // Do nothing here. The custom event will handle all tracking.
          //console.info("Click on .colorbox item has been detected.");
        }
        // Is download tracking activated and the file extension configured for download tracking?
        else if (Drupal.settings.googleanalytics.trackDownload && Drupal.googleanalytics.isDownload(this.href)) {
          // Download link clicked.
          ga("send", {
            "hitType": "event",
            "eventCategory": "Downloads",
            "eventAction": Drupal.googleanalytics.getDownloadExtension(this.href).toUpperCase(),
            "eventLabel": Drupal.googleanalytics.getPageUrl(this.href),
            "transport": "beacon"
          });
        }
        else if (Drupal.googleanalytics.isInternalSpecial(this.href)) {
          // Keep the internal URL for Google Analytics website overlay intact.
          ga("send", {
            "hitType": "pageview",
            "page": Drupal.googleanalytics.getPageUrl(this.href),
            "transport": "beacon"
          });
        }
      }
      else {
        if (Drupal.settings.googleanalytics.trackMailto && $(this).is("a[href^='mailto:'],area[href^='mailto:']")) {
          // Mailto link clicked.
          ga("send", {
            "hitType": "event",
            "eventCategory": "Mails",
            "eventAction": "Click",
            "eventLabel": this.href.substring(7),
            "transport": "beacon"
          });
        }
        else if (Drupal.settings.googleanalytics.trackOutbound && this.href.match(/^\w+:\/\//i)) {
          if (Drupal.settings.googleanalytics.trackDomainMode !== 2 || (Drupal.settings.googleanalytics.trackDomainMode === 2 && !Drupal.googleanalytics.isCrossDomain(this.hostname, Drupal.settings.googleanalytics.trackCrossDomains))) {
            // External link clicked / No top-level cross domain clicked.
            ga("send", {
              "hitType": "event",
              "eventCategory": "Outbound links",
              "eventAction": "Click",
              "eventLabel": this.href,
              "transport": "beacon"
            });
          }
        }
      }
    });
  });

  // Track hash changes as unique pageviews, if this option has been enabled.
  if (Drupal.settings.googleanalytics.trackUrlFragments) {
    window.onhashchange = function() {
      ga("send", {
        "hitType": "pageview",
        "page": location.pathname + location.search + location.hash
      });
    };
  }

  // Colorbox: This event triggers when the transition has completed and the
  // newly loaded content has been revealed.
  if (Drupal.settings.googleanalytics.trackColorbox) {
    $(document).bind("cbox_complete", function () {
      var href = $.colorbox.element().attr("href");
      if (href) {
        ga("send", {
          "hitType": "pageview",
          "page": Drupal.googleanalytics.getPageUrl(href)
        });
      }
    });
  }

});

/**
 * Check whether the hostname is part of the cross domains or not.
 *
 * @param string hostname
 *   The hostname of the clicked URL.
 * @param array crossDomains
 *   All cross domain hostnames as JS array.
 *
 * @return boolean
 */
Drupal.googleanalytics.isCrossDomain = function (hostname, crossDomains) {
  /**
   * jQuery < 1.6.3 bug: $.inArray crushes IE6 and Chrome if second argument is
   * `null` or `undefined`, https://bugs.jquery.com/ticket/10076,
   * https://github.com/jquery/jquery/commit/a839af034db2bd934e4d4fa6758a3fed8de74174
   *
   * @todo: Remove/Refactor in D8
   */
  if (!crossDomains) {
    return false;
  }
  else {
    return $.inArray(hostname, crossDomains) > -1 ? true : false;
  }
};

/**
 * Check whether this is a download URL or not.
 *
 * @param string url
 *   The web url to check.
 *
 * @return boolean
 */
Drupal.googleanalytics.isDownload = function (url) {
  var isDownload = new RegExp("\\.(" + Drupal.settings.googleanalytics.trackDownloadExtensions + ")([\?#].*)?$", "i");
  return isDownload.test(url);
};

/**
 * Check whether this is an absolute internal URL or not.
 *
 * @param string url
 *   The web url to check.
 *
 * @return boolean
 */
Drupal.googleanalytics.isInternal = function (url) {
  var isInternal = new RegExp("^(https?):\/\/" + window.location.host, "i");
  return isInternal.test(url);
};

/**
 * Check whether this is a special URL or not.
 *
 * URL types:
 *  - gotwo.module /go/* links.
 *
 * @param string url
 *   The web url to check.
 *
 * @return boolean
 */
Drupal.googleanalytics.isInternalSpecial = function (url) {
  var isInternalSpecial = new RegExp("(\/go\/.*)$", "i");
  return isInternalSpecial.test(url);
};

/**
 * Extract the relative internal URL from an absolute internal URL.
 *
 * Examples:
 * - https://mydomain.com/node/1 -> /node/1
 * - https://example.com/foo/bar -> https://example.com/foo/bar
 *
 * @param string url
 *   The web url to check.
 *
 * @return string
 *   Internal website URL
 */
Drupal.googleanalytics.getPageUrl = function (url) {
  var extractInternalUrl = new RegExp("^(https?):\/\/" + window.location.host, "i");
  return url.replace(extractInternalUrl, '');
};

/**
 * Extract the download file extension from the URL.
 *
 * @param string url
 *   The web url to check.
 *
 * @return string
 *   The file extension of the passed url. e.g. "zip", "txt"
 */
Drupal.googleanalytics.getDownloadExtension = function (url) {
  var extractDownloadextension = new RegExp("\\.(" + Drupal.settings.googleanalytics.trackDownloadExtensions + ")([\?#].*)?$", "i");
  var extension = extractDownloadextension.exec(url);
  return (extension === null) ? '' : extension[1];
};

})(jQuery);
;
